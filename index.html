<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Interactive Question Viewer - English (no Math)</title>

    <!-- Font (system stack is fine) -->

    <!-- DOMPurify for safe HTML -->
    <script
      data-keep="lib"
      data-inline-lib="1"
      data-injected="1"
      data-origin="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"
      defer=""
      src="data:text/javascript;base64,LyohIEBsaWNlbnNlIERPTVB1cmlmeSAzLjEuNiB8IChjKSBDdXJlNTMgYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IFJlbGVhc2VkIHVuZGVyIHRoZSBBcGFjaGUgbGljZW5zZSAyLjAgYW5kIE1vemlsbGEgUHVibGljIExpY2Vuc2UgMi4wIHwgZ2l0aHViLmNvbS9jdXJlNTMvRE9NUHVyaWZ5L2Jsb2IvMy4xLjYvTElDRU5TRSAqLwohZnVuY3Rpb24oZSx0KXsib2JqZWN0Ij09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT10eXBlb2YgbW9kdWxlP21vZHVsZS5leHBvcnRzPXQoKToiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZSh0KTooZT0idW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpczplfHxzZWxmKS5ET01QdXJpZnk9dCgpfSh0aGlzLChmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijtjb25zdHtlbnRyaWVzOmUsc2V0UHJvdG90eXBlT2Y6dCxpc0Zyb3plbjpuLGdldFByb3RvdHlwZU9mOm8sZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOnJ9PU9iamVjdDtsZXR7ZnJlZXplOmksc2VhbDphLGNyZWF0ZTpsfT1PYmplY3Qse2FwcGx5OmMsY29uc3RydWN0OnN9PSJ1bmRlZmluZWQiIT10eXBlb2YgUmVmbGVjdCYmUmVmbGVjdDtpfHwoaT1mdW5jdGlvbihlKXtyZXR1cm4gZX0pLGF8fChhPWZ1bmN0aW9uKGUpe3JldHVybiBlfSksY3x8KGM9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBlLmFwcGx5KHQsbil9KSxzfHwocz1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgZSguLi50KX0pO2NvbnN0IHU9YihBcnJheS5wcm90b3R5cGUuZm9yRWFjaCksbT1iKEFycmF5LnByb3RvdHlwZS5wb3ApLHA9YihBcnJheS5wcm90b3R5cGUucHVzaCksZj1iKFN0cmluZy5wcm90b3R5cGUudG9Mb3dlckNhc2UpLGQ9YihTdHJpbmcucHJvdG90eXBlLnRvU3RyaW5nKSxoPWIoU3RyaW5nLnByb3RvdHlwZS5tYXRjaCksZz1iKFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSksVD1iKFN0cmluZy5wcm90b3R5cGUuaW5kZXhPZikseT1iKFN0cmluZy5wcm90b3R5cGUudHJpbSksRT1iKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkpLF89YihSZWdFeHAucHJvdG90eXBlLnRlc3QpLEE9KE49VHlwZUVycm9yLGZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSksbj0wO248ZTtuKyspdFtuXT1hcmd1bWVudHNbbl07cmV0dXJuIHMoTix0KX0pO3ZhciBOO2Z1bmN0aW9uIGIoZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgbj1hcmd1bWVudHMubGVuZ3RoLG89bmV3IEFycmF5KG4+MT9uLTE6MCkscj0xO3I8bjtyKyspb1tyLTFdPWFyZ3VtZW50c1tyXTtyZXR1cm4gYyhlLHQsbyl9fWZ1bmN0aW9uIFMoZSxvKXtsZXQgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06Zjt0JiZ0KGUsbnVsbCk7bGV0IGk9by5sZW5ndGg7Zm9yKDtpLS07KXtsZXQgdD1vW2ldO2lmKCJzdHJpbmciPT10eXBlb2YgdCl7Y29uc3QgZT1yKHQpO2UhPT10JiYobihvKXx8KG9baV09ZSksdD1lKX1lW3RdPSEwfXJldHVybiBlfWZ1bmN0aW9uIFIoZSl7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspe0UoZSx0KXx8KGVbdF09bnVsbCl9cmV0dXJuIGV9ZnVuY3Rpb24gdyh0KXtjb25zdCBuPWwobnVsbCk7Zm9yKGNvbnN0W28scl1vZiBlKHQpKXtFKHQsbykmJihBcnJheS5pc0FycmF5KHIpP25bb109UihyKTpyJiYib2JqZWN0Ij09dHlwZW9mIHImJnIuY29uc3RydWN0b3I9PT1PYmplY3Q/bltvXT13KHIpOm5bb109cil9cmV0dXJuIG59ZnVuY3Rpb24gQyhlLHQpe2Zvcig7bnVsbCE9PWU7KXtjb25zdCBuPXIoZSx0KTtpZihuKXtpZihuLmdldClyZXR1cm4gYihuLmdldCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4udmFsdWUpcmV0dXJuIGIobi52YWx1ZSl9ZT1vKGUpfXJldHVybiBmdW5jdGlvbigpe3JldHVybiBudWxsfX1jb25zdCBMPWkoWyJhIiwiYWJiciIsImFjcm9ueW0iLCJhZGRyZXNzIiwiYXJlYSIsImFydGljbGUiLCJhc2lkZSIsImF1ZGlvIiwiYiIsImJkaSIsImJkbyIsImJpZyIsImJsaW5rIiwiYmxvY2txdW90ZSIsImJvZHkiLCJiciIsImJ1dHRvbiIsImNhbnZhcyIsImNhcHRpb24iLCJjZW50ZXIiLCJjaXRlIiwiY29kZSIsImNvbCIsImNvbGdyb3VwIiwiY29udGVudCIsImRhdGEiLCJkYXRhbGlzdCIsImRkIiwiZGVjb3JhdG9yIiwiZGVsIiwiZGV0YWlscyIsImRmbiIsImRpYWxvZyIsImRpciIsImRpdiIsImRsIiwiZHQiLCJlbGVtZW50IiwiZW0iLCJmaWVsZHNldCIsImZpZ2NhcHRpb24iLCJmaWd1cmUiLCJmb250IiwiZm9vdGVyIiwiZm9ybSIsImgxIiwiaDIiLCJoMyIsImg0IiwiaDUiLCJoNiIsImhlYWQiLCJoZWFkZXIiLCJoZ3JvdXAiLCJociIsImh0bWwiLCJpIiwiaW1nIiwiaW5wdXQiLCJpbnMiLCJrYmQiLCJsYWJlbCIsImxlZ2VuZCIsImxpIiwibWFpbiIsIm1hcCIsIm1hcmsiLCJtYXJxdWVlIiwibWVudSIsIm1lbnVpdGVtIiwibWV0ZXIiLCJuYXYiLCJub2JyIiwib2wiLCJvcHRncm91cCIsIm9wdGlvbiIsIm91dHB1dCIsInAiLCJwaWN0dXJlIiwicHJlIiwicHJvZ3Jlc3MiLCJxIiwicnAiLCJydCIsInJ1YnkiLCJzIiwic2FtcCIsInNlY3Rpb24iLCJzZWxlY3QiLCJzaGFkb3ciLCJzbWFsbCIsInNvdXJjZSIsInNwYWNlciIsInNwYW4iLCJzdHJpa2UiLCJzdHJvbmciLCJzdHlsZSIsInN1YiIsInN1bW1hcnkiLCJzdXAiLCJ0YWJsZSIsInRib2R5IiwidGQiLCJ0ZW1wbGF0ZSIsInRleHRhcmVhIiwidGZvb3QiLCJ0aCIsInRoZWFkIiwidGltZSIsInRyIiwidHJhY2siLCJ0dCIsInUiLCJ1bCIsInZhciIsInZpZGVvIiwid2JyIl0pLEQ9aShbInN2ZyIsImEiLCJhbHRnbHlwaCIsImFsdGdseXBoZGVmIiwiYWx0Z2x5cGhpdGVtIiwiYW5pbWF0ZWNvbG9yIiwiYW5pbWF0ZW1vdGlvbiIsImFuaW1hdGV0cmFuc2Zvcm0iLCJjaXJjbGUiLCJjbGlwcGF0aCIsImRlZnMiLCJkZXNjIiwiZWxsaXBzZSIsImZpbHRlciIsImZvbnQiLCJnIiwiZ2x5cGgiLCJnbHlwaHJlZiIsImhrZXJuIiwiaW1hZ2UiLCJsaW5lIiwibGluZWFyZ3JhZGllbnQiLCJtYXJrZXIiLCJtYXNrIiwibWV0YWRhdGEiLCJtcGF0aCIsInBhdGgiLCJwYXR0ZXJuIiwicG9seWdvbiIsInBvbHlsaW5lIiwicmFkaWFsZ3JhZGllbnQiLCJyZWN0Iiwic3RvcCIsInN0eWxlIiwic3dpdGNoIiwic3ltYm9sIiwidGV4dCIsInRleHRwYXRoIiwidGl0bGUiLCJ0cmVmIiwidHNwYW4iLCJ2aWV3Iiwidmtlcm4iXSksdj1pKFsiZmVCbGVuZCIsImZlQ29sb3JNYXRyaXgiLCJmZUNvbXBvbmVudFRyYW5zZmVyIiwiZmVDb21wb3NpdGUiLCJmZUNvbnZvbHZlTWF0cml4IiwiZmVEaWZmdXNlTGlnaHRpbmciLCJmZURpc3BsYWNlbWVudE1hcCIsImZlRGlzdGFudExpZ2h0IiwiZmVEcm9wU2hhZG93IiwiZmVGbG9vZCIsImZlRnVuY0EiLCJmZUZ1bmNCIiwiZmVGdW5jRyIsImZlRnVuY1IiLCJmZUdhdXNzaWFuQmx1ciIsImZlSW1hZ2UiLCJmZU1lcmdlIiwiZmVNZXJnZU5vZGUiLCJmZU1vcnBob2xvZ3kiLCJmZU9mZnNldCIsImZlUG9pbnRMaWdodCIsImZlU3BlY3VsYXJMaWdodGluZyIsImZlU3BvdExpZ2h0IiwiZmVUaWxlIiwiZmVUdXJidWxlbmNlIl0pLE89aShbImFuaW1hdGUiLCJjb2xvci1wcm9maWxlIiwiY3Vyc29yIiwiZGlzY2FyZCIsImZvbnQtZmFjZSIsImZvbnQtZmFjZS1mb3JtYXQiLCJmb250LWZhY2UtbmFtZSIsImZvbnQtZmFjZS1zcmMiLCJmb250LWZhY2UtdXJpIiwiZm9yZWlnbm9iamVjdCIsImhhdGNoIiwiaGF0Y2hwYXRoIiwibWVzaCIsIm1lc2hncmFkaWVudCIsIm1lc2hwYXRjaCIsIm1lc2hyb3ciLCJtaXNzaW5nLWdseXBoIiwic2NyaXB0Iiwic2V0Iiwic29saWRjb2xvciIsInVua25vd24iLCJ1c2UiXSkseD1pKFsibWF0aCIsIm1lbmNsb3NlIiwibWVycm9yIiwibWZlbmNlZCIsIm1mcmFjIiwibWdseXBoIiwibWkiLCJtbGFiZWxlZHRyIiwibW11bHRpc2NyaXB0cyIsIm1uIiwibW8iLCJtb3ZlciIsIm1wYWRkZWQiLCJtcGhhbnRvbSIsIm1yb290IiwibXJvdyIsIm1zIiwibXNwYWNlIiwibXNxcnQiLCJtc3R5bGUiLCJtc3ViIiwibXN1cCIsIm1zdWJzdXAiLCJtdGFibGUiLCJtdGQiLCJtdGV4dCIsIm10ciIsIm11bmRlciIsIm11bmRlcm92ZXIiLCJtcHJlc2NyaXB0cyJdKSxrPWkoWyJtYWN0aW9uIiwibWFsaWduZ3JvdXAiLCJtYWxpZ25tYXJrIiwibWxvbmdkaXYiLCJtc2NhcnJpZXMiLCJtc2NhcnJ5IiwibXNncm91cCIsIm1zdGFjayIsIm1zbGluZSIsIm1zcm93Iiwic2VtYW50aWNzIiwiYW5ub3RhdGlvbiIsImFubm90YXRpb24teG1sIiwibXByZXNjcmlwdHMiLCJub25lIl0pLE09aShbIiN0ZXh0Il0pLEk9aShbImFjY2VwdCIsImFjdGlvbiIsImFsaWduIiwiYWx0IiwiYXV0b2NhcGl0YWxpemUiLCJhdXRvY29tcGxldGUiLCJhdXRvcGljdHVyZWlucGljdHVyZSIsImF1dG9wbGF5IiwiYmFja2dyb3VuZCIsImJnY29sb3IiLCJib3JkZXIiLCJjYXB0dXJlIiwiY2VsbHBhZGRpbmciLCJjZWxsc3BhY2luZyIsImNoZWNrZWQiLCJjaXRlIiwiY2xhc3MiLCJjbGVhciIsImNvbG9yIiwiY29scyIsImNvbHNwYW4iLCJjb250cm9scyIsImNvbnRyb2xzbGlzdCIsImNvb3JkcyIsImNyb3Nzb3JpZ2luIiwiZGF0ZXRpbWUiLCJkZWNvZGluZyIsImRlZmF1bHQiLCJkaXIiLCJkaXNhYmxlZCIsImRpc2FibGVwaWN0dXJlaW5waWN0dXJlIiwiZGlzYWJsZXJlbW90ZXBsYXliYWNrIiwiZG93bmxvYWQiLCJkcmFnZ2FibGUiLCJlbmN0eXBlIiwiZW50ZXJrZXloaW50IiwiZmFjZSIsImZvciIsImhlYWRlcnMiLCJoZWlnaHQiLCJoaWRkZW4iLCJoaWdoIiwiaHJlZiIsImhyZWZsYW5nIiwiaWQiLCJpbnB1dG1vZGUiLCJpbnRlZ3JpdHkiLCJpc21hcCIsImtpbmQiLCJsYWJlbCIsImxhbmciLCJsaXN0IiwibG9hZGluZyIsImxvb3AiLCJsb3ciLCJtYXgiLCJtYXhsZW5ndGgiLCJtZWRpYSIsIm1ldGhvZCIsIm1pbiIsIm1pbmxlbmd0aCIsIm11bHRpcGxlIiwibXV0ZWQiLCJuYW1lIiwibm9uY2UiLCJub3NoYWRlIiwibm92YWxpZGF0ZSIsIm5vd3JhcCIsIm9wZW4iLCJvcHRpbXVtIiwicGF0dGVybiIsInBsYWNlaG9sZGVyIiwicGxheXNpbmxpbmUiLCJwb3BvdmVyIiwicG9wb3ZlcnRhcmdldCIsInBvcG92ZXJ0YXJnZXRhY3Rpb24iLCJwb3N0ZXIiLCJwcmVsb2FkIiwicHViZGF0ZSIsInJhZGlvZ3JvdXAiLCJyZWFkb25seSIsInJlbCIsInJlcXVpcmVkIiwicmV2IiwicmV2ZXJzZWQiLCJyb2xlIiwicm93cyIsInJvd3NwYW4iLCJzcGVsbGNoZWNrIiwic2NvcGUiLCJzZWxlY3RlZCIsInNoYXBlIiwic2l6ZSIsInNpemVzIiwic3BhbiIsInNyY2xhbmciLCJzdGFydCIsInNyYyIsInNyY3NldCIsInN0ZXAiLCJzdHlsZSIsInN1bW1hcnkiLCJ0YWJpbmRleCIsInRpdGxlIiwidHJhbnNsYXRlIiwidHlwZSIsInVzZW1hcCIsInZhbGlnbiIsInZhbHVlIiwid2lkdGgiLCJ3cmFwIiwieG1sbnMiLCJzbG90Il0pLFU9aShbImFjY2VudC1oZWlnaHQiLCJhY2N1bXVsYXRlIiwiYWRkaXRpdmUiLCJhbGlnbm1lbnQtYmFzZWxpbmUiLCJhc2NlbnQiLCJhdHRyaWJ1dGVuYW1lIiwiYXR0cmlidXRldHlwZSIsImF6aW11dGgiLCJiYXNlZnJlcXVlbmN5IiwiYmFzZWxpbmUtc2hpZnQiLCJiZWdpbiIsImJpYXMiLCJieSIsImNsYXNzIiwiY2xpcCIsImNsaXBwYXRodW5pdHMiLCJjbGlwLXBhdGgiLCJjbGlwLXJ1bGUiLCJjb2xvciIsImNvbG9yLWludGVycG9sYXRpb24iLCJjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMiLCJjb2xvci1wcm9maWxlIiwiY29sb3ItcmVuZGVyaW5nIiwiY3giLCJjeSIsImQiLCJkeCIsImR5IiwiZGlmZnVzZWNvbnN0YW50IiwiZGlyZWN0aW9uIiwiZGlzcGxheSIsImRpdmlzb3IiLCJkdXIiLCJlZGdlbW9kZSIsImVsZXZhdGlvbiIsImVuZCIsImZpbGwiLCJmaWxsLW9wYWNpdHkiLCJmaWxsLXJ1bGUiLCJmaWx0ZXIiLCJmaWx0ZXJ1bml0cyIsImZsb29kLWNvbG9yIiwiZmxvb2Qtb3BhY2l0eSIsImZvbnQtZmFtaWx5IiwiZm9udC1zaXplIiwiZm9udC1zaXplLWFkanVzdCIsImZvbnQtc3RyZXRjaCIsImZvbnQtc3R5bGUiLCJmb250LXZhcmlhbnQiLCJmb250LXdlaWdodCIsImZ4IiwiZnkiLCJnMSIsImcyIiwiZ2x5cGgtbmFtZSIsImdseXBocmVmIiwiZ3JhZGllbnR1bml0cyIsImdyYWRpZW50dHJhbnNmb3JtIiwiaGVpZ2h0IiwiaHJlZiIsImlkIiwiaW1hZ2UtcmVuZGVyaW5nIiwiaW4iLCJpbjIiLCJrIiwiazEiLCJrMiIsImszIiwiazQiLCJrZXJuaW5nIiwia2V5cG9pbnRzIiwia2V5c3BsaW5lcyIsImtleXRpbWVzIiwibGFuZyIsImxlbmd0aGFkanVzdCIsImxldHRlci1zcGFjaW5nIiwia2VybmVsbWF0cml4Iiwia2VybmVsdW5pdGxlbmd0aCIsImxpZ2h0aW5nLWNvbG9yIiwibG9jYWwiLCJtYXJrZXItZW5kIiwibWFya2VyLW1pZCIsIm1hcmtlci1zdGFydCIsIm1hcmtlcmhlaWdodCIsIm1hcmtlcnVuaXRzIiwibWFya2Vyd2lkdGgiLCJtYXNrY29udGVudHVuaXRzIiwibWFza3VuaXRzIiwibWF4IiwibWFzayIsIm1lZGlhIiwibWV0aG9kIiwibW9kZSIsIm1pbiIsIm5hbWUiLCJudW1vY3RhdmVzIiwib2Zmc2V0Iiwib3BlcmF0b3IiLCJvcGFjaXR5Iiwib3JkZXIiLCJvcmllbnQiLCJvcmllbnRhdGlvbiIsIm9yaWdpbiIsIm92ZXJmbG93IiwicGFpbnQtb3JkZXIiLCJwYXRoIiwicGF0aGxlbmd0aCIsInBhdHRlcm5jb250ZW50dW5pdHMiLCJwYXR0ZXJudHJhbnNmb3JtIiwicGF0dGVybnVuaXRzIiwicG9pbnRzIiwicHJlc2VydmVhbHBoYSIsInByZXNlcnZlYXNwZWN0cmF0aW8iLCJwcmltaXRpdmV1bml0cyIsInIiLCJyeCIsInJ5IiwicmFkaXVzIiwicmVmeCIsInJlZnkiLCJyZXBlYXRjb3VudCIsInJlcGVhdGR1ciIsInJlc3RhcnQiLCJyZXN1bHQiLCJyb3RhdGUiLCJzY2FsZSIsInNlZWQiLCJzaGFwZS1yZW5kZXJpbmciLCJzcGVjdWxhcmNvbnN0YW50Iiwic3BlY3VsYXJleHBvbmVudCIsInNwcmVhZG1ldGhvZCIsInN0YXJ0b2Zmc2V0Iiwic3RkZGV2aWF0aW9uIiwic3RpdGNodGlsZXMiLCJzdG9wLWNvbG9yIiwic3RvcC1vcGFjaXR5Iiwic3Ryb2tlLWRhc2hhcnJheSIsInN0cm9rZS1kYXNob2Zmc2V0Iiwic3Ryb2tlLWxpbmVjYXAiLCJzdHJva2UtbGluZWpvaW4iLCJzdHJva2UtbWl0ZXJsaW1pdCIsInN0cm9rZS1vcGFjaXR5Iiwic3Ryb2tlIiwic3Ryb2tlLXdpZHRoIiwic3R5bGUiLCJzdXJmYWNlc2NhbGUiLCJzeXN0ZW1sYW5ndWFnZSIsInRhYmluZGV4IiwidGFyZ2V0eCIsInRhcmdldHkiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2Zvcm0tb3JpZ2luIiwidGV4dC1hbmNob3IiLCJ0ZXh0LWRlY29yYXRpb24iLCJ0ZXh0LXJlbmRlcmluZyIsInRleHRsZW5ndGgiLCJ0eXBlIiwidTEiLCJ1MiIsInVuaWNvZGUiLCJ2YWx1ZXMiLCJ2aWV3Ym94IiwidmlzaWJpbGl0eSIsInZlcnNpb24iLCJ2ZXJ0LWFkdi15IiwidmVydC1vcmlnaW4teCIsInZlcnQtb3JpZ2luLXkiLCJ3aWR0aCIsIndvcmQtc3BhY2luZyIsIndyYXAiLCJ3cml0aW5nLW1vZGUiLCJ4Y2hhbm5lbHNlbGVjdG9yIiwieWNoYW5uZWxzZWxlY3RvciIsIngiLCJ4MSIsIngyIiwieG1sbnMiLCJ5IiwieTEiLCJ5MiIsInoiLCJ6b29tYW5kcGFuIl0pLFA9aShbImFjY2VudCIsImFjY2VudHVuZGVyIiwiYWxpZ24iLCJiZXZlbGxlZCIsImNsb3NlIiwiY29sdW1uc2FsaWduIiwiY29sdW1ubGluZXMiLCJjb2x1bW5zcGFuIiwiZGVub21hbGlnbiIsImRlcHRoIiwiZGlyIiwiZGlzcGxheSIsImRpc3BsYXlzdHlsZSIsImVuY29kaW5nIiwiZmVuY2UiLCJmcmFtZSIsImhlaWdodCIsImhyZWYiLCJpZCIsImxhcmdlb3AiLCJsZW5ndGgiLCJsaW5ldGhpY2tuZXNzIiwibHNwYWNlIiwibHF1b3RlIiwibWF0aGJhY2tncm91bmQiLCJtYXRoY29sb3IiLCJtYXRoc2l6ZSIsIm1hdGh2YXJpYW50IiwibWF4c2l6ZSIsIm1pbnNpemUiLCJtb3ZhYmxlbGltaXRzIiwibm90YXRpb24iLCJudW1hbGlnbiIsIm9wZW4iLCJyb3dhbGlnbiIsInJvd2xpbmVzIiwicm93c3BhY2luZyIsInJvd3NwYW4iLCJyc3BhY2UiLCJycXVvdGUiLCJzY3JpcHRsZXZlbCIsInNjcmlwdG1pbnNpemUiLCJzY3JpcHRzaXplbXVsdGlwbGllciIsInNlbGVjdGlvbiIsInNlcGFyYXRvciIsInNlcGFyYXRvcnMiLCJzdHJldGNoeSIsInN1YnNjcmlwdHNoaWZ0Iiwic3Vwc2NyaXB0c2hpZnQiLCJzeW1tZXRyaWMiLCJ2b2Zmc2V0Iiwid2lkdGgiLCJ4bWxucyJdKSxGPWkoWyJ4bGluazpocmVmIiwieG1sOmlkIiwieGxpbms6dGl0bGUiLCJ4bWw6c3BhY2UiLCJ4bWxuczp4bGluayJdKSxIPWEoL1x7XHtbXHdcV10qfFtcd1xXXSpcfVx9L2dtKSx6PWEoLzwlW1x3XFddKnxbXHdcV10qJT4vZ20pLEI9YSgvXCR7W1x3XFddKn0vZ20pLFc9YSgvXmRhdGEtW1wtXHcuXHUwMEI3LVx1RkZGRl0vKSxHPWEoL15hcmlhLVtcLVx3XSskLyksWT1hKC9eKD86KD86KD86ZnxodCl0cHM/fG1haWx0b3x0ZWx8Y2FsbHRvfHNtc3xjaWR8eG1wcCk6fFteYS16XXxbYS16Ky5cLV0rKD86W15hLXorLlwtOl18JCkpL2kpLGo9YSgvXig/Olx3K3NjcmlwdHxkYXRhKTovaSksWD1hKC9bXHUwMDAwLVx1MDAyMFx1MDBBMFx1MTY4MFx1MTgwRVx1MjAwMC1cdTIwMjlcdTIwNUZcdTMwMDBdL2cpLHE9YSgvXmh0bWwkL2kpLCQ9YSgvXlthLXpdWy5cd10qKC1bLlx3XSspKyQvaSk7dmFyIEs9T2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsTVVTVEFDSEVfRVhQUjpILEVSQl9FWFBSOnosVE1QTElUX0VYUFI6QixEQVRBX0FUVFI6VyxBUklBX0FUVFI6RyxJU19BTExPV0VEX1VSSTpZLElTX1NDUklQVF9PUl9EQVRBOmosQVRUUl9XSElURVNQQUNFOlgsRE9DVFlQRV9OQU1FOnEsQ1VTVE9NX0VMRU1FTlQ6JH0pO2NvbnN0IFY9MSxaPTMsSj03LFE9OCxlZT05LHRlPWZ1bmN0aW9uKCl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/bnVsbDp3aW5kb3d9O3ZhciBuZT1mdW5jdGlvbiB0KCl7bGV0IG49YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnRlKCk7Y29uc3Qgbz1lPT50KGUpO2lmKG8udmVyc2lvbj0iMy4xLjYiLG8ucmVtb3ZlZD1bXSwhbnx8IW4uZG9jdW1lbnR8fG4uZG9jdW1lbnQubm9kZVR5cGUhPT1lZSlyZXR1cm4gby5pc1N1cHBvcnRlZD0hMSxvO2xldHtkb2N1bWVudDpyfT1uO2NvbnN0IGE9cixjPWEuY3VycmVudFNjcmlwdCx7RG9jdW1lbnRGcmFnbWVudDpzLEhUTUxUZW1wbGF0ZUVsZW1lbnQ6TixOb2RlOmIsRWxlbWVudDpSLE5vZGVGaWx0ZXI6SCxOYW1lZE5vZGVNYXA6ej1uLk5hbWVkTm9kZU1hcHx8bi5Nb3pOYW1lZEF0dHJNYXAsSFRNTEZvcm1FbGVtZW50OkIsRE9NUGFyc2VyOlcsdHJ1c3RlZFR5cGVzOkd9PW4saj1SLnByb3RvdHlwZSxYPUMoaiwiY2xvbmVOb2RlIiksJD1DKGosInJlbW92ZSIpLG5lPUMoaiwibmV4dFNpYmxpbmciKSxvZT1DKGosImNoaWxkTm9kZXMiKSxyZT1DKGosInBhcmVudE5vZGUiKTtpZigiZnVuY3Rpb24iPT10eXBlb2YgTil7Y29uc3QgZT1yLmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7ZS5jb250ZW50JiZlLmNvbnRlbnQub3duZXJEb2N1bWVudCYmKHI9ZS5jb250ZW50Lm93bmVyRG9jdW1lbnQpfWxldCBpZSxhZT0iIjtjb25zdHtpbXBsZW1lbnRhdGlvbjpsZSxjcmVhdGVOb2RlSXRlcmF0b3I6Y2UsY3JlYXRlRG9jdW1lbnRGcmFnbWVudDpzZSxnZXRFbGVtZW50c0J5VGFnTmFtZTp1ZX09cix7aW1wb3J0Tm9kZTptZX09YTtsZXQgcGU9e307by5pc1N1cHBvcnRlZD0iZnVuY3Rpb24iPT10eXBlb2YgZSYmImZ1bmN0aW9uIj09dHlwZW9mIHJlJiZsZSYmdm9pZCAwIT09bGUuY3JlYXRlSFRNTERvY3VtZW50O2NvbnN0e01VU1RBQ0hFX0VYUFI6ZmUsRVJCX0VYUFI6ZGUsVE1QTElUX0VYUFI6aGUsREFUQV9BVFRSOmdlLEFSSUFfQVRUUjpUZSxJU19TQ1JJUFRfT1JfREFUQTp5ZSxBVFRSX1dISVRFU1BBQ0U6RWUsQ1VTVE9NX0VMRU1FTlQ6X2V9PUs7bGV0e0lTX0FMTE9XRURfVVJJOkFlfT1LLE5lPW51bGw7Y29uc3QgYmU9Uyh7fSxbLi4uTCwuLi5ELC4uLnYsLi4ueCwuLi5NXSk7bGV0IFNlPW51bGw7Y29uc3QgUmU9Uyh7fSxbLi4uSSwuLi5VLC4uLlAsLi4uRl0pO2xldCB3ZT1PYmplY3Quc2VhbChsKG51bGwse3RhZ05hbWVDaGVjazp7d3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiExLGVudW1lcmFibGU6ITAsdmFsdWU6bnVsbH0sYXR0cmlidXRlTmFtZUNoZWNrOnt3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITEsZW51bWVyYWJsZTohMCx2YWx1ZTpudWxsfSxhbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHM6e3dyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMSxlbnVtZXJhYmxlOiEwLHZhbHVlOiExfX0pKSxDZT1udWxsLExlPW51bGwsRGU9ITAsdmU9ITAsT2U9ITEseGU9ITAsa2U9ITEsTWU9ITAsSWU9ITEsVWU9ITEsUGU9ITEsRmU9ITEsSGU9ITEsemU9ITEsQmU9ITAsV2U9ITEsR2U9ITAsWWU9ITEsamU9e30sWGU9bnVsbDtjb25zdCBxZT1TKHt9LFsiYW5ub3RhdGlvbi14bWwiLCJhdWRpbyIsImNvbGdyb3VwIiwiZGVzYyIsImZvcmVpZ25vYmplY3QiLCJoZWFkIiwiaWZyYW1lIiwibWF0aCIsIm1pIiwibW4iLCJtbyIsIm1zIiwibXRleHQiLCJub2VtYmVkIiwibm9mcmFtZXMiLCJub3NjcmlwdCIsInBsYWludGV4dCIsInNjcmlwdCIsInN0eWxlIiwic3ZnIiwidGVtcGxhdGUiLCJ0aGVhZCIsInRpdGxlIiwidmlkZW8iLCJ4bXAiXSk7bGV0ICRlPW51bGw7Y29uc3QgS2U9Uyh7fSxbImF1ZGlvIiwidmlkZW8iLCJpbWciLCJzb3VyY2UiLCJpbWFnZSIsInRyYWNrIl0pO2xldCBWZT1udWxsO2NvbnN0IFplPVMoe30sWyJhbHQiLCJjbGFzcyIsImZvciIsImlkIiwibGFiZWwiLCJuYW1lIiwicGF0dGVybiIsInBsYWNlaG9sZGVyIiwicm9sZSIsInN1bW1hcnkiLCJ0aXRsZSIsInZhbHVlIiwic3R5bGUiLCJ4bWxucyJdKSxKZT0iaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCIsUWU9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixldD0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7bGV0IHR0PWV0LG50PSExLG90PW51bGw7Y29uc3QgcnQ9Uyh7fSxbSmUsUWUsZXRdLGQpO2xldCBpdD1udWxsO2NvbnN0IGF0PVsiYXBwbGljYXRpb24veGh0bWwreG1sIiwidGV4dC9odG1sIl07bGV0IGx0PW51bGwsY3Q9bnVsbDtjb25zdCBzdD1yLmNyZWF0ZUVsZW1lbnQoImZvcm0iKSx1dD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIFJlZ0V4cHx8ZSBpbnN0YW5jZW9mIEZ1bmN0aW9ufSxtdD1mdW5jdGlvbigpe2xldCBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fTtpZighY3R8fGN0IT09ZSl7aWYoZSYmIm9iamVjdCI9PXR5cGVvZiBlfHwoZT17fSksZT13KGUpLGl0PS0xPT09YXQuaW5kZXhPZihlLlBBUlNFUl9NRURJQV9UWVBFKT8idGV4dC9odG1sIjplLlBBUlNFUl9NRURJQV9UWVBFLGx0PSJhcHBsaWNhdGlvbi94aHRtbCt4bWwiPT09aXQ/ZDpmLE5lPUUoZSwiQUxMT1dFRF9UQUdTIik/Uyh7fSxlLkFMTE9XRURfVEFHUyxsdCk6YmUsU2U9RShlLCJBTExPV0VEX0FUVFIiKT9TKHt9LGUuQUxMT1dFRF9BVFRSLGx0KTpSZSxvdD1FKGUsIkFMTE9XRURfTkFNRVNQQUNFUyIpP1Moe30sZS5BTExPV0VEX05BTUVTUEFDRVMsZCk6cnQsVmU9RShlLCJBRERfVVJJX1NBRkVfQVRUUiIpP1ModyhaZSksZS5BRERfVVJJX1NBRkVfQVRUUixsdCk6WmUsJGU9RShlLCJBRERfREFUQV9VUklfVEFHUyIpP1ModyhLZSksZS5BRERfREFUQV9VUklfVEFHUyxsdCk6S2UsWGU9RShlLCJGT1JCSURfQ09OVEVOVFMiKT9TKHt9LGUuRk9SQklEX0NPTlRFTlRTLGx0KTpxZSxDZT1FKGUsIkZPUkJJRF9UQUdTIik/Uyh7fSxlLkZPUkJJRF9UQUdTLGx0KTp7fSxMZT1FKGUsIkZPUkJJRF9BVFRSIik/Uyh7fSxlLkZPUkJJRF9BVFRSLGx0KTp7fSxqZT0hIUUoZSwiVVNFX1BST0ZJTEVTIikmJmUuVVNFX1BST0ZJTEVTLERlPSExIT09ZS5BTExPV19BUklBX0FUVFIsdmU9ITEhPT1lLkFMTE9XX0RBVEFfQVRUUixPZT1lLkFMTE9XX1VOS05PV05fUFJPVE9DT0xTfHwhMSx4ZT0hMSE9PWUuQUxMT1dfU0VMRl9DTE9TRV9JTl9BVFRSLGtlPWUuU0FGRV9GT1JfVEVNUExBVEVTfHwhMSxNZT0hMSE9PWUuU0FGRV9GT1JfWE1MLEllPWUuV0hPTEVfRE9DVU1FTlR8fCExLEZlPWUuUkVUVVJOX0RPTXx8ITEsSGU9ZS5SRVRVUk5fRE9NX0ZSQUdNRU5UfHwhMSx6ZT1lLlJFVFVSTl9UUlVTVEVEX1RZUEV8fCExLFBlPWUuRk9SQ0VfQk9EWXx8ITEsQmU9ITEhPT1lLlNBTklUSVpFX0RPTSxXZT1lLlNBTklUSVpFX05BTUVEX1BST1BTfHwhMSxHZT0hMSE9PWUuS0VFUF9DT05URU5ULFllPWUuSU5fUExBQ0V8fCExLEFlPWUuQUxMT1dFRF9VUklfUkVHRVhQfHxZLHR0PWUuTkFNRVNQQUNFfHxldCx3ZT1lLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HfHx7fSxlLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HJiZ1dChlLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjaykmJih3ZS50YWdOYW1lQ2hlY2s9ZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2spLGUuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcmJnV0KGUuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcuYXR0cmlidXRlTmFtZUNoZWNrKSYmKHdlLmF0dHJpYnV0ZU5hbWVDaGVjaz1lLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjayksZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORyYmImJvb2xlYW4iPT10eXBlb2YgZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMmJih3ZS5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHM9ZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMpLGtlJiYodmU9ITEpLEhlJiYoRmU9ITApLGplJiYoTmU9Uyh7fSxNKSxTZT1bXSwhMD09PWplLmh0bWwmJihTKE5lLEwpLFMoU2UsSSkpLCEwPT09amUuc3ZnJiYoUyhOZSxEKSxTKFNlLFUpLFMoU2UsRikpLCEwPT09amUuc3ZnRmlsdGVycyYmKFMoTmUsdiksUyhTZSxVKSxTKFNlLEYpKSwhMD09PWplLm1hdGhNbCYmKFMoTmUseCksUyhTZSxQKSxTKFNlLEYpKSksZS5BRERfVEFHUyYmKE5lPT09YmUmJihOZT13KE5lKSksUyhOZSxlLkFERF9UQUdTLGx0KSksZS5BRERfQVRUUiYmKFNlPT09UmUmJihTZT13KFNlKSksUyhTZSxlLkFERF9BVFRSLGx0KSksZS5BRERfVVJJX1NBRkVfQVRUUiYmUyhWZSxlLkFERF9VUklfU0FGRV9BVFRSLGx0KSxlLkZPUkJJRF9DT05URU5UUyYmKFhlPT09cWUmJihYZT13KFhlKSksUyhYZSxlLkZPUkJJRF9DT05URU5UUyxsdCkpLEdlJiYoTmVbIiN0ZXh0Il09ITApLEllJiZTKE5lLFsiaHRtbCIsImhlYWQiLCJib2R5Il0pLE5lLnRhYmxlJiYoUyhOZSxbInRib2R5Il0pLGRlbGV0ZSBDZS50Ym9keSksZS5UUlVTVEVEX1RZUEVTX1BPTElDWSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUuVFJVU1RFRF9UWVBFU19QT0xJQ1kuY3JlYXRlSFRNTCl0aHJvdyBBKCdUUlVTVEVEX1RZUEVTX1BPTElDWSBjb25maWd1cmF0aW9uIG9wdGlvbiBtdXN0IHByb3ZpZGUgYSAiY3JlYXRlSFRNTCIgaG9vay4nKTtpZigiZnVuY3Rpb24iIT10eXBlb2YgZS5UUlVTVEVEX1RZUEVTX1BPTElDWS5jcmVhdGVTY3JpcHRVUkwpdGhyb3cgQSgnVFJVU1RFRF9UWVBFU19QT0xJQ1kgY29uZmlndXJhdGlvbiBvcHRpb24gbXVzdCBwcm92aWRlIGEgImNyZWF0ZVNjcmlwdFVSTCIgaG9vay4nKTtpZT1lLlRSVVNURURfVFlQRVNfUE9MSUNZLGFlPWllLmNyZWF0ZUhUTUwoIiIpfWVsc2Ugdm9pZCAwPT09aWUmJihpZT1mdW5jdGlvbihlLHQpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUuY3JlYXRlUG9saWN5KXJldHVybiBudWxsO2xldCBuPW51bGw7Y29uc3Qgbz0iZGF0YS10dC1wb2xpY3ktc3VmZml4Ijt0JiZ0Lmhhc0F0dHJpYnV0ZShvKSYmKG49dC5nZXRBdHRyaWJ1dGUobykpO2NvbnN0IHI9ImRvbXB1cmlmeSIrKG4/IiMiK246IiIpO3RyeXtyZXR1cm4gZS5jcmVhdGVQb2xpY3kocix7Y3JlYXRlSFRNTDplPT5lLGNyZWF0ZVNjcmlwdFVSTDplPT5lfSl9Y2F0Y2goZSl7cmV0dXJuIGNvbnNvbGUud2FybigiVHJ1c3RlZFR5cGVzIHBvbGljeSAiK3IrIiBjb3VsZCBub3QgYmUgY3JlYXRlZC4iKSxudWxsfX0oRyxjKSksbnVsbCE9PWllJiYic3RyaW5nIj09dHlwZW9mIGFlJiYoYWU9aWUuY3JlYXRlSFRNTCgiIikpO2kmJmkoZSksY3Q9ZX19LHB0PVMoe30sWyJtaSIsIm1vIiwibW4iLCJtcyIsIm10ZXh0Il0pLGZ0PVMoe30sWyJmb3JlaWdub2JqZWN0IiwiYW5ub3RhdGlvbi14bWwiXSksZHQ9Uyh7fSxbInRpdGxlIiwic3R5bGUiLCJmb250IiwiYSIsInNjcmlwdCJdKSxodD1TKHt9LFsuLi5ELC4uLnYsLi4uT10pLGd0PVMoe30sWy4uLngsLi4ua10pLFR0PWZ1bmN0aW9uKGUpe3Aoby5yZW1vdmVkLHtlbGVtZW50OmV9KTt0cnl7cmUoZSkucmVtb3ZlQ2hpbGQoZSl9Y2F0Y2godCl7JChlKX19LHl0PWZ1bmN0aW9uKGUsdCl7dHJ5e3Aoby5yZW1vdmVkLHthdHRyaWJ1dGU6dC5nZXRBdHRyaWJ1dGVOb2RlKGUpLGZyb206dH0pfWNhdGNoKGUpe3Aoby5yZW1vdmVkLHthdHRyaWJ1dGU6bnVsbCxmcm9tOnR9KX1pZih0LnJlbW92ZUF0dHJpYnV0ZShlKSwiaXMiPT09ZSYmIVNlW2VdKWlmKEZlfHxIZSl0cnl7VHQodCl9Y2F0Y2goZSl7fWVsc2UgdHJ5e3Quc2V0QXR0cmlidXRlKGUsIiIpfWNhdGNoKGUpe319LEV0PWZ1bmN0aW9uKGUpe2xldCB0PW51bGwsbj1udWxsO2lmKFBlKWU9IjxyZW1vdmU+PC9yZW1vdmU+IitlO2Vsc2V7Y29uc3QgdD1oKGUsL15bXHJcblx0IF0rLyk7bj10JiZ0WzBdfSJhcHBsaWNhdGlvbi94aHRtbCt4bWwiPT09aXQmJnR0PT09ZXQmJihlPSc8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+PGhlYWQ+PC9oZWFkPjxib2R5PicrZSsiPC9ib2R5PjwvaHRtbD4iKTtjb25zdCBvPWllP2llLmNyZWF0ZUhUTUwoZSk6ZTtpZih0dD09PWV0KXRyeXt0PShuZXcgVykucGFyc2VGcm9tU3RyaW5nKG8saXQpfWNhdGNoKGUpe31pZighdHx8IXQuZG9jdW1lbnRFbGVtZW50KXt0PWxlLmNyZWF0ZURvY3VtZW50KHR0LCJ0ZW1wbGF0ZSIsbnVsbCk7dHJ5e3QuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTD1udD9hZTpvfWNhdGNoKGUpe319Y29uc3QgaT10LmJvZHl8fHQuZG9jdW1lbnRFbGVtZW50O3JldHVybiBlJiZuJiZpLmluc2VydEJlZm9yZShyLmNyZWF0ZVRleHROb2RlKG4pLGkuY2hpbGROb2Rlc1swXXx8bnVsbCksdHQ9PT1ldD91ZS5jYWxsKHQsSWU/Imh0bWwiOiJib2R5IilbMF06SWU/dC5kb2N1bWVudEVsZW1lbnQ6aX0sX3Q9ZnVuY3Rpb24oZSl7cmV0dXJuIGNlLmNhbGwoZS5vd25lckRvY3VtZW50fHxlLGUsSC5TSE9XX0VMRU1FTlR8SC5TSE9XX0NPTU1FTlR8SC5TSE9XX1RFWFR8SC5TSE9XX1BST0NFU1NJTkdfSU5TVFJVQ1RJT058SC5TSE9XX0NEQVRBX1NFQ1RJT04sbnVsbCl9LEF0PWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgQiYmKCJzdHJpbmciIT10eXBlb2YgZS5ub2RlTmFtZXx8InN0cmluZyIhPXR5cGVvZiBlLnRleHRDb250ZW50fHwiZnVuY3Rpb24iIT10eXBlb2YgZS5yZW1vdmVDaGlsZHx8IShlLmF0dHJpYnV0ZXMgaW5zdGFuY2VvZiB6KXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUucmVtb3ZlQXR0cmlidXRlfHwiZnVuY3Rpb24iIT10eXBlb2YgZS5zZXRBdHRyaWJ1dGV8fCJzdHJpbmciIT10eXBlb2YgZS5uYW1lc3BhY2VVUkl8fCJmdW5jdGlvbiIhPXR5cGVvZiBlLmluc2VydEJlZm9yZXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUuaGFzQ2hpbGROb2Rlcyl9LE50PWZ1bmN0aW9uKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBiJiZlIGluc3RhbmNlb2YgYn0sYnQ9ZnVuY3Rpb24oZSx0LG4pe3BlW2VdJiZ1KHBlW2VdLChlPT57ZS5jYWxsKG8sdCxuLGN0KX0pKX0sU3Q9ZnVuY3Rpb24oZSl7bGV0IHQ9bnVsbDtpZihidCgiYmVmb3JlU2FuaXRpemVFbGVtZW50cyIsZSxudWxsKSxBdChlKSlyZXR1cm4gVHQoZSksITA7Y29uc3Qgbj1sdChlLm5vZGVOYW1lKTtpZihidCgidXBvblNhbml0aXplRWxlbWVudCIsZSx7dGFnTmFtZTpuLGFsbG93ZWRUYWdzOk5lfSksZS5oYXNDaGlsZE5vZGVzKCkmJiFOdChlLmZpcnN0RWxlbWVudENoaWxkKSYmXygvPFsvXHddL2csZS5pbm5lckhUTUwpJiZfKC88Wy9cd10vZyxlLnRleHRDb250ZW50KSlyZXR1cm4gVHQoZSksITA7aWYoZS5ub2RlVHlwZT09PUopcmV0dXJuIFR0KGUpLCEwO2lmKE1lJiZlLm5vZGVUeXBlPT09USYmXygvPFsvXHddL2csZS5kYXRhKSlyZXR1cm4gVHQoZSksITA7aWYoIU5lW25dfHxDZVtuXSl7aWYoIUNlW25dJiZ3dChuKSl7aWYod2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgUmVnRXhwJiZfKHdlLnRhZ05hbWVDaGVjayxuKSlyZXR1cm4hMTtpZih3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBGdW5jdGlvbiYmd2UudGFnTmFtZUNoZWNrKG4pKXJldHVybiExfWlmKEdlJiYhWGVbbl0pe2NvbnN0IHQ9cmUoZSl8fGUucGFyZW50Tm9kZSxuPW9lKGUpfHxlLmNoaWxkTm9kZXM7aWYobiYmdCl7Zm9yKGxldCBvPW4ubGVuZ3RoLTE7bz49MDstLW8pe2NvbnN0IHI9WChuW29dLCEwKTtyLl9fcmVtb3ZhbENvdW50PShlLl9fcmVtb3ZhbENvdW50fHwwKSsxLHQuaW5zZXJ0QmVmb3JlKHIsbmUoZSkpfX19cmV0dXJuIFR0KGUpLCEwfXJldHVybiBlIGluc3RhbmNlb2YgUiYmIWZ1bmN0aW9uKGUpe2xldCB0PXJlKGUpO3QmJnQudGFnTmFtZXx8KHQ9e25hbWVzcGFjZVVSSTp0dCx0YWdOYW1lOiJ0ZW1wbGF0ZSJ9KTtjb25zdCBuPWYoZS50YWdOYW1lKSxvPWYodC50YWdOYW1lKTtyZXR1cm4hIW90W2UubmFtZXNwYWNlVVJJXSYmKGUubmFtZXNwYWNlVVJJPT09UWU/dC5uYW1lc3BhY2VVUkk9PT1ldD8ic3ZnIj09PW46dC5uYW1lc3BhY2VVUkk9PT1KZT8ic3ZnIj09PW4mJigiYW5ub3RhdGlvbi14bWwiPT09b3x8cHRbb10pOkJvb2xlYW4oaHRbbl0pOmUubmFtZXNwYWNlVVJJPT09SmU/dC5uYW1lc3BhY2VVUkk9PT1ldD8ibWF0aCI9PT1uOnQubmFtZXNwYWNlVVJJPT09UWU/Im1hdGgiPT09biYmZnRbb106Qm9vbGVhbihndFtuXSk6ZS5uYW1lc3BhY2VVUkk9PT1ldD8hKHQubmFtZXNwYWNlVVJJPT09UWUmJiFmdFtvXSkmJiEodC5uYW1lc3BhY2VVUkk9PT1KZSYmIXB0W29dKSYmIWd0W25dJiYoZHRbbl18fCFodFtuXSk6ISgiYXBwbGljYXRpb24veGh0bWwreG1sIiE9PWl0fHwhb3RbZS5uYW1lc3BhY2VVUkldKSl9KGUpPyhUdChlKSwhMCk6Im5vc2NyaXB0IiE9PW4mJiJub2VtYmVkIiE9PW4mJiJub2ZyYW1lcyIhPT1ufHwhXygvPFwvbm8oc2NyaXB0fGVtYmVkfGZyYW1lcykvaSxlLmlubmVySFRNTCk/KGtlJiZlLm5vZGVUeXBlPT09WiYmKHQ9ZS50ZXh0Q29udGVudCx1KFtmZSxkZSxoZV0sKGU9Pnt0PWcodCxlLCIgIil9KSksZS50ZXh0Q29udGVudCE9PXQmJihwKG8ucmVtb3ZlZCx7ZWxlbWVudDplLmNsb25lTm9kZSgpfSksZS50ZXh0Q29udGVudD10KSksYnQoImFmdGVyU2FuaXRpemVFbGVtZW50cyIsZSxudWxsKSwhMSk6KFR0KGUpLCEwKX0sUnQ9ZnVuY3Rpb24oZSx0LG4pe2lmKEJlJiYoImlkIj09PXR8fCJuYW1lIj09PXQpJiYobiBpbiByfHxuIGluIHN0KSlyZXR1cm4hMTtpZih2ZSYmIUxlW3RdJiZfKGdlLHQpKTtlbHNlIGlmKERlJiZfKFRlLHQpKTtlbHNlIGlmKCFTZVt0XXx8TGVbdF0pe2lmKCEod3QoZSkmJih3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBSZWdFeHAmJl8od2UudGFnTmFtZUNoZWNrLGUpfHx3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBGdW5jdGlvbiYmd2UudGFnTmFtZUNoZWNrKGUpKSYmKHdlLmF0dHJpYnV0ZU5hbWVDaGVjayBpbnN0YW5jZW9mIFJlZ0V4cCYmXyh3ZS5hdHRyaWJ1dGVOYW1lQ2hlY2ssdCl8fHdlLmF0dHJpYnV0ZU5hbWVDaGVjayBpbnN0YW5jZW9mIEZ1bmN0aW9uJiZ3ZS5hdHRyaWJ1dGVOYW1lQ2hlY2sodCkpfHwiaXMiPT09dCYmd2UuYWxsb3dDdXN0b21pemVkQnVpbHRJbkVsZW1lbnRzJiYod2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgUmVnRXhwJiZfKHdlLnRhZ05hbWVDaGVjayxuKXx8d2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgRnVuY3Rpb24mJndlLnRhZ05hbWVDaGVjayhuKSkpKXJldHVybiExfWVsc2UgaWYoVmVbdF0pO2Vsc2UgaWYoXyhBZSxnKG4sRWUsIiIpKSk7ZWxzZSBpZigic3JjIiE9PXQmJiJ4bGluazpocmVmIiE9PXQmJiJocmVmIiE9PXR8fCJzY3JpcHQiPT09ZXx8MCE9PVQobiwiZGF0YToiKXx8ISRlW2VdKXtpZihPZSYmIV8oeWUsZyhuLEVlLCIiKSkpO2Vsc2UgaWYobilyZXR1cm4hMX1lbHNlO3JldHVybiEwfSx3dD1mdW5jdGlvbihlKXtyZXR1cm4iYW5ub3RhdGlvbi14bWwiIT09ZSYmaChlLF9lKX0sQ3Q9ZnVuY3Rpb24oZSl7YnQoImJlZm9yZVNhbml0aXplQXR0cmlidXRlcyIsZSxudWxsKTtjb25zdHthdHRyaWJ1dGVzOnR9PWU7aWYoIXQpcmV0dXJuO2NvbnN0IG49e2F0dHJOYW1lOiIiLGF0dHJWYWx1ZToiIixrZWVwQXR0cjohMCxhbGxvd2VkQXR0cmlidXRlczpTZX07bGV0IHI9dC5sZW5ndGg7Zm9yKDtyLS07KXtjb25zdCBpPXRbcl0se25hbWU6YSxuYW1lc3BhY2VVUkk6bCx2YWx1ZTpjfT1pLHM9bHQoYSk7bGV0IHA9InZhbHVlIj09PWE/Yzp5KGMpO2lmKG4uYXR0ck5hbWU9cyxuLmF0dHJWYWx1ZT1wLG4ua2VlcEF0dHI9ITAsbi5mb3JjZUtlZXBBdHRyPXZvaWQgMCxidCgidXBvblNhbml0aXplQXR0cmlidXRlIixlLG4pLHA9bi5hdHRyVmFsdWUsTWUmJl8oLygoLS0hP3xdKT4pfDxcLyhzdHlsZXx0aXRsZSkvaSxwKSl7eXQoYSxlKTtjb250aW51ZX1pZihuLmZvcmNlS2VlcEF0dHIpY29udGludWU7aWYoeXQoYSxlKSwhbi5rZWVwQXR0ciljb250aW51ZTtpZigheGUmJl8oL1wvPi9pLHApKXt5dChhLGUpO2NvbnRpbnVlfWtlJiZ1KFtmZSxkZSxoZV0sKGU9PntwPWcocCxlLCIgIil9KSk7Y29uc3QgZj1sdChlLm5vZGVOYW1lKTtpZihSdChmLHMscCkpe2lmKCFXZXx8ImlkIiE9PXMmJiJuYW1lIiE9PXN8fCh5dChhLGUpLHA9InVzZXItY29udGVudC0iK3ApLGllJiYib2JqZWN0Ij09dHlwZW9mIEcmJiJmdW5jdGlvbiI9PXR5cGVvZiBHLmdldEF0dHJpYnV0ZVR5cGUpaWYobCk7ZWxzZSBzd2l0Y2goRy5nZXRBdHRyaWJ1dGVUeXBlKGYscykpe2Nhc2UiVHJ1c3RlZEhUTUwiOnA9aWUuY3JlYXRlSFRNTChwKTticmVhaztjYXNlIlRydXN0ZWRTY3JpcHRVUkwiOnA9aWUuY3JlYXRlU2NyaXB0VVJMKHApfXRyeXtsP2Uuc2V0QXR0cmlidXRlTlMobCxhLHApOmUuc2V0QXR0cmlidXRlKGEscCksQXQoZSk/VHQoZSk6bShvLnJlbW92ZWQpfWNhdGNoKGUpe319fWJ0KCJhZnRlclNhbml0aXplQXR0cmlidXRlcyIsZSxudWxsKX0sTHQ9ZnVuY3Rpb24gZSh0KXtsZXQgbj1udWxsO2NvbnN0IG89X3QodCk7Zm9yKGJ0KCJiZWZvcmVTYW5pdGl6ZVNoYWRvd0RPTSIsdCxudWxsKTtuPW8ubmV4dE5vZGUoKTspYnQoInVwb25TYW5pdGl6ZVNoYWRvd05vZGUiLG4sbnVsbCksU3Qobil8fChuLmNvbnRlbnQgaW5zdGFuY2VvZiBzJiZlKG4uY29udGVudCksQ3QobikpO2J0KCJhZnRlclNhbml0aXplU2hhZG93RE9NIix0LG51bGwpfTtyZXR1cm4gby5zYW5pdGl6ZT1mdW5jdGlvbihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e30sbj1udWxsLHI9bnVsbCxpPW51bGwsbD1udWxsO2lmKG50PSFlLG50JiYoZT0iXHgzYyEtLVx4M2UiKSwic3RyaW5nIiE9dHlwZW9mIGUmJiFOdChlKSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUudG9TdHJpbmcpdGhyb3cgQSgidG9TdHJpbmcgaXMgbm90IGEgZnVuY3Rpb24iKTtpZigic3RyaW5nIiE9dHlwZW9mKGU9ZS50b1N0cmluZygpKSl0aHJvdyBBKCJkaXJ0eSBpcyBub3QgYSBzdHJpbmcsIGFib3J0aW5nIil9aWYoIW8uaXNTdXBwb3J0ZWQpcmV0dXJuIGU7aWYoVWV8fG10KHQpLG8ucmVtb3ZlZD1bXSwic3RyaW5nIj09dHlwZW9mIGUmJihZZT0hMSksWWUpe2lmKGUubm9kZU5hbWUpe2NvbnN0IHQ9bHQoZS5ub2RlTmFtZSk7aWYoIU5lW3RdfHxDZVt0XSl0aHJvdyBBKCJyb290IG5vZGUgaXMgZm9yYmlkZGVuIGFuZCBjYW5ub3QgYmUgc2FuaXRpemVkIGluLXBsYWNlIil9fWVsc2UgaWYoZSBpbnN0YW5jZW9mIGIpbj1FdCgiXHgzYyEtLS0tXHgzZSIpLHI9bi5vd25lckRvY3VtZW50LmltcG9ydE5vZGUoZSwhMCksci5ub2RlVHlwZT09PVYmJiJCT0RZIj09PXIubm9kZU5hbWV8fCJIVE1MIj09PXIubm9kZU5hbWU/bj1yOm4uYXBwZW5kQ2hpbGQocik7ZWxzZXtpZighRmUmJiFrZSYmIUllJiYtMT09PWUuaW5kZXhPZigiPCIpKXJldHVybiBpZSYmemU/aWUuY3JlYXRlSFRNTChlKTplO2lmKG49RXQoZSksIW4pcmV0dXJuIEZlP251bGw6emU/YWU6IiJ9biYmUGUmJlR0KG4uZmlyc3RDaGlsZCk7Y29uc3QgYz1fdChZZT9lOm4pO2Zvcig7aT1jLm5leHROb2RlKCk7KVN0KGkpfHwoaS5jb250ZW50IGluc3RhbmNlb2YgcyYmTHQoaS5jb250ZW50KSxDdChpKSk7aWYoWWUpcmV0dXJuIGU7aWYoRmUpe2lmKEhlKWZvcihsPXNlLmNhbGwobi5vd25lckRvY3VtZW50KTtuLmZpcnN0Q2hpbGQ7KWwuYXBwZW5kQ2hpbGQobi5maXJzdENoaWxkKTtlbHNlIGw9bjtyZXR1cm4oU2Uuc2hhZG93cm9vdHx8U2Uuc2hhZG93cm9vdG1vZGUpJiYobD1tZS5jYWxsKGEsbCwhMCkpLGx9bGV0IG09SWU/bi5vdXRlckhUTUw6bi5pbm5lckhUTUw7cmV0dXJuIEllJiZOZVsiIWRvY3R5cGUiXSYmbi5vd25lckRvY3VtZW50JiZuLm93bmVyRG9jdW1lbnQuZG9jdHlwZSYmbi5vd25lckRvY3VtZW50LmRvY3R5cGUubmFtZSYmXyhxLG4ub3duZXJEb2N1bWVudC5kb2N0eXBlLm5hbWUpJiYobT0iPCFET0NUWVBFICIrbi5vd25lckRvY3VtZW50LmRvY3R5cGUubmFtZSsiPlxuIittKSxrZSYmdShbZmUsZGUsaGVdLChlPT57bT1nKG0sZSwiICIpfSkpLGllJiZ6ZT9pZS5jcmVhdGVIVE1MKG0pOm19LG8uc2V0Q29uZmlnPWZ1bmN0aW9uKCl7bXQoYXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnt9KSxVZT0hMH0sby5jbGVhckNvbmZpZz1mdW5jdGlvbigpe2N0PW51bGwsVWU9ITF9LG8uaXNWYWxpZEF0dHJpYnV0ZT1mdW5jdGlvbihlLHQsbil7Y3R8fG10KHt9KTtjb25zdCBvPWx0KGUpLHI9bHQodCk7cmV0dXJuIFJ0KG8scixuKX0sby5hZGRIb29rPWZ1bmN0aW9uKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIHQmJihwZVtlXT1wZVtlXXx8W10scChwZVtlXSx0KSl9LG8ucmVtb3ZlSG9vaz1mdW5jdGlvbihlKXtpZihwZVtlXSlyZXR1cm4gbShwZVtlXSl9LG8ucmVtb3ZlSG9va3M9ZnVuY3Rpb24oZSl7cGVbZV0mJihwZVtlXT1bXSl9LG8ucmVtb3ZlQWxsSG9va3M9ZnVuY3Rpb24oKXtwZT17fX0sb30oKTtyZXR1cm4gbmV9KSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXB1cmlmeS5taW4uanMubWFwCg=="
    ></script>

    <link
      rel="icon"
      href="https://ensanbinadam.github.io/quiz_viewer_general_en/favicon.ico"
    />

    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      body {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        color: #fff;
      }
      .container {
        max-width: 900px;
        margin: 20px auto;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeIn 0.5s ease-out forwards;
      }
      .header {
        text-align: center;
        margin-bottom: 18px;
      }
      .quiz-box {
        background: rgba(255, 255, 255, 0.96);
        border-radius: 15px;
        padding: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        color: #333;
        position: relative;
        overflow: auto;
      }
      .question {
        font-size: 1.4em;
        margin-bottom: 18px;
        font-weight: 700;
        line-height: 1.5;
        text-align: left;
      }
      .options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .options-row {
        display: grid;
        gap: 10px;
      }
      .options-two {
        grid-template-columns: repeat(2, 1fr);
        max-width: 500px;
        margin: 0 auto;
      }
      .options-three {
        grid-template-columns: repeat(3, 1fr);
        max-width: 750px;
        margin: 0 auto;
      }
      .option {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.2s;
        border: 2px solid transparent;
        min-height: 110px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .option:hover {
        transform: translateX(8px);
        background: #eef1f4;
      }
      .option.correct {
        background: #28a745 !important;
        color: #fff !important;
      }
      .option.wrong {
        background: #dc3545 !important;
        color: #fff !important;
      }
      .option[aria-disabled="true"] {
        pointer-events: none;
        opacity: 0.9;
      }

      :root {
        --max-img-desktop: 60vh;
        --max-img-mobile: 45vh;
      }

      /* صور السؤال والنص القرائي (حقول الصورة المنفصلة) */
      .question-image,
      .reading-text-image {
        width: 100%;
        height: auto;
        object-fit: contain;
        max-height: var(--max-img-desktop);
        border-radius: 8px;
        margin: 8px 0;
        display: block;
      }

      /* الصور المدمجة داخل HTML النصي */
      .reading-text-content img,
      .question-text img {
        max-width: 100%;
        height: auto;
        object-fit: contain;
        max-height: var(--max-img-desktop);
        display: block;
        margin: 8px auto;
      }

      @media (max-width: 768px) {
        .question-image,
        .reading-text-image,
        .reading-text-content img,
        .question-text img {
          max-height: var(--max-img-mobile);
        }
      }

      .option-image {
        background: transparent !important;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-top: 16px;
      }
      .nav-btn {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 10px 22px;
        border-radius: 20px;
        cursor: pointer;
        transition: 0.2s;
      }
      .nav-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      .pause-btn {
        background: #ffc107;
        color: #000;
      }
      .progress-bar {
        height: 8px;
        background: #dee2e6;
        border-radius: 4px;
        margin: 16px 0;
        overflow: hidden;
      }
      .progress {
        height: 100%;
        background: #4caf50;
        width: 0;
        transition: width 0.3s ease;
      }
      .score-board {
        text-align: center;
        font-size: 1.5em;
        display: none;
      }
      .restart-btn {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 12px 28px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1.05em;
        margin: 18px auto;
        display: block;
        transition: transform 0.2s ease;
      }
      .reading-text {
        background: rgba(255, 255, 255, 0.9);
        color: #1e3c72;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
        font-size: 1.1em;
        line-height: 1.8;
        font-weight: 500;
        text-align: left;
      }
      .config-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #fff;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      @keyframes fadeIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .counters {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: -8px 0 16px 0;
        padding: 14px;
        background: rgba(255, 255, 255, 0.96);
        border-radius: 10px;
        font-weight: 600;
        color: #2a5298;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
        font-size: 1.05em;
        gap: 10px;
      }
      #timer {
        flex: 1;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.9);
        padding: 8px 18px;
        border-radius: 24px;
        font-weight: 800;
      }
      #questionCounter::before {
        content: "📌 ";
        margin-right: 6px;
      }
      #scoreCounter::before {
        content: "🏆 ";
        margin-right: 6px;
      }
      #timer::before {
        content: "⏳";
        font-size: 1.2em;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
        100% {
          transform: scale(1);
        }
      }

      .question-content {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 12px;
      }
      .option-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        width: 100%;
      }
      .option-text {
        text-align: center;
        padding: 4px;
        width: 100%;
        font-size: 18px;
        font-weight: 700;
        color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .buttons-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 14px 0;
      }
      .action-btn {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 10px 18px;
        border-radius: 20px;
        cursor: pointer;
        transition: 0.2s;
        font-size: 0.95em;
      }
      .action-btn.settings-btn {
        background: #6c757d;
      }
      .action-btn.sample {
        background: #28a745;
      }

      .settings-panel {
        background: #fff;
        padding: 16px;
        border-radius: 10px;
        margin-bottom: 16px;
        color: #333;
        border: 1px solid #ccc;
        margin-top: 10px;
        max-width: 640px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
        display: none;
      }
      .settings-title {
        font-weight: 800;
        margin-bottom: 10px;
        font-size: 18px;
      }
      .settings-option {
        margin-bottom: 10px;
      }
      .settings-option label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .settings-option select,
      .settings-option input {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }

      .config-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 22px;
        border-radius: 14px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        display: none;
        color: #333;
        z-index: 9999;
        width: 92%;
        max-width: 520px;
      }
      .form-control {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        resize: vertical;
      }
      .form-group {
        margin-top: 12px;
      }

      footer {
        position: relative;
        width: 100%;
        text-align: center;
        padding: 10px;
        background: #f1f1f1;
        color: #333;
        direction: ltr;
        border-radius: 10px;
        margin-top: 16px;
      }

      .reading-text a,
      .question a,
      .option-text a {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .options {
          grid-template-columns: 1fr;
        }
        .option {
          min-height: 100px;
        }
        .question {
          font-size: 1.2em;
        }
      }
      /* Keyboard focus visibility for better accessibility */
      .option:focus,
      .option:focus-visible {
        outline: 3px solid #007bff;
        outline-offset: 2px;
      }
      .nav-btn:focus,
      .action-btn:focus {
        outline: 3px solid #2a5298;
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <button
      class="config-btn"
      onclick="toggleConfigPanel()"
      aria-label="Control panel"
    >
      ⚙️
    </button>

    <div class="container">
      <div class="header">
        <h1 id="quizTitle">General Quiz - Lite</h1>
        <p id="instructions">
          Select the correct answer for each question before time runs out.
        </p>
      </div>

      <div class="buttons-container" id="teacherButtons">
        <button class="action-btn" id="loadButton">Load Questions</button>
        <button
          class="action-btn settings-btn"
          id="settingsBtn"
          onclick="toggleSettingsPanel()"
        >
          Display Settings
        </button>
        <button class="action-btn" id="editButton" onclick="toggleEditMode()">
          Edit Question
        </button>
        <button class="action-btn" id="saveQuestionsButton">
          Save Questions
        </button>
        <button class="action-btn" id="saveAppButton">
          Student Version
        </button>
        <button
          class="action-btn"
          id="resetProgressBtn"
          onclick="resetProgress()"
        >
          Reset Progress
        </button>
      </div>

      <div class="settings-panel" id="editPanel" style="display: none">
        <div class="settings-title">Edit Question</div>
        <div class="settings-option">
          <label for="editReadingText">Reading text:</label>
          <textarea
            id="editReadingText"
            class="form-control"
            rows="4"
          ></textarea>
          <label for="editReadingImage">Reading image:</label>
          <input type="file" id="editReadingImage" accept="image/*" />
          <img
            id="readingImagePreview"
            style="
              display: none;
              max-width: 100%;
              max-height: 160px;
              margin: 8px 0;
            "
          />
        </div>
        <div class="settings-option">
          <label for="editQuestionText">Question:</label>
          <input type="text" id="editQuestionText" class="form-control" />
          <label for="editQuestionImage">Question image:</label>
          <input type="file" id="editQuestionImage" accept="image/*" />
          <img
            id="questionImagePreview"
            style="
              display: none;
              max-width: 100%;
              max-height: 160px;
              margin: 8px 0;
            "
          />
        </div>
        <div class="settings-option">
          <label>Options:</label>
          <div style="display: grid; gap: 10px">
            <div>
              <input type="checkbox" id="correct1" />
              <label for="editOption1">Option 1:</label>
              <input type="text" id="editOption1" class="form-control" />
              <input type="file" id="editOptionImage1" accept="image/*" />
              <img
                id="optionImagePreview1"
                style="
                  display: none;
                  max-width: 100%;
                  max-height: 110px;
                  margin: 8px 0;
                "
              />
            </div>
            <div>
              <input type="checkbox" id="correct2" />
              <label for="editOption2">Option 2:</label>
              <input type="text" id="editOption2" class="form-control" />
              <input type="file" id="editOptionImage2" accept="image/*" />
              <img
                id="optionImagePreview2"
                style="
                  display: none;
                  max-width: 100%;
                  max-height: 110px;
                  margin: 8px 0;
                "
              />
            </div>
            <div>
              <input type="checkbox" id="correct3" />
              <label for="editOption3">Option 3:</label>
              <input type="text" id="editOption3" class="form-control" />
              <input type="file" id="editOptionImage3" accept="image/*" />
              <img
                id="optionImagePreview3"
                style="
                  display: none;
                  max-width: 100%;
                  max-height: 110px;
                  margin: 8px 0;
                "
              />
            </div>
            <div>
              <input type="checkbox" id="correct4" />
              <label for="editOption4">Option 4:</label>
              <input type="text" id="editOption4" class="form-control" />
              <input type="file" id="editOptionImage4" accept="image/*" />
              <img
                id="optionImagePreview4"
                style="
                  display: none;
                  max-width: 100%;
                  max-height: 110px;
                  margin: 8px 0;
                "
              />
            </div>
          </div>
        </div>
        <div
          class="settings-footer"
          style="
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
          "
        >
          <button
            class="nav-btn"
            onclick="saveEdit()"
            style="background: #28a745"
          >
            Save
          </button>
          <button
            class="nav-btn"
            onclick="addNewQuestion()"
            style="background: #007bff"
          >
            Add Question
          </button>
          <button
            class="nav-btn"
            onclick="deleteCurrentQuestion()"
            style="background: #dc3545"
          >
            Delete
          </button>
          <button class="nav-btn" onclick="cancelEdit()">Cancel</button>
        </div>
      </div>

      <div class="settings-panel" id="settingsPanel">
        <div class="settings-title">Display Settings</div>
        <div class="settings-option">
          <label for="numeralType">Digits:</label>
          <select id="numeralType" onchange="changeNumeralType()">
            <option value="arabic" selected="">Latin (1, 2, 3)</option>
            <option value="eastern">Eastern Arabic (١, ٢, ٣)</option>
          </select>
        </div>
        <div class="settings-option">
          <button
            onclick="cleanEasternNumerals()"
            style="
              margin-top: 8px;
              background-color: #dc3545;
              color: white;
              padding: 6px 10px;
              border: none;
              border-radius: 6px;
              cursor: pointer;
            "
          >
            🧹 Clean Eastern digits inside questions
          </button>
        </div>
        <div class="settings-option">
          <label for="questionTime">Time per question (seconds):</label>
          <input
            id="questionTime"
            type="number"
            min="5"
            max="180"
            value="30"
            onchange="changeQuestionTime()"
          />
        </div>
        <div class="settings-footer">
          <button class="nav-btn" onclick="toggleSettingsPanel()">
            Save &amp; Close
          </button>
        </div>
      </div>

      <div class="counters" id="countersBox">
        <div id="questionCounter" aria-live="polite">📌 Question 0 of 0</div>
        <div id="timer" aria-live="polite">⏳ Time left: 0 seconds</div>
        <div id="scoreCounter" aria-live="polite">🏆 Score: 0 of 0</div>
      </div>

      <div class="reading-text" id="readingText" style="display: none"></div>

      <div class="quiz-box">
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
        <div class="controls">
          <button
            class="nav-btn"
            id="prevBtn"
            onclick="previousQuestion()"
            disabled=""
          >
            Previous
          </button>
          <button
            class="nav-btn pause-btn"
            id="pauseBtn"
            onclick="togglePause()"
          >
            Pause
          </button>
          <button
            class="nav-btn"
            id="nextBtn"
            onclick="nextQuestion()"
            disabled=""
          >
            Next
          </button>
        </div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
    </div>

    <div class="score-board" id="scoreBoard">
      <h2>
        Your final score: <span id="finalScore">0</span>/<span
          id="totalQuestions"
          >0</span
        >
      </h2>
      <button class="restart-btn" onclick="restartQuiz()">Retry</button>
    </div>

    <div class="config-panel" id="configPanel">
      <h3>Control Panel</h3>
      <label for="titleInput">Quiz title:</label>
      <input class="form-control" id="titleInput" type="text" />
      <label for="instructionsInput" class="form-group">Instructions:</label>
      <textarea class="form-control" id="instructionsInput" rows="4"></textarea>
      <div class="form-group">
        <label for="footerInput">Footer:</label>
        <textarea class="form-control" id="footerInput" rows="3">
Prepared &amp; designed by • English Department</textarea
        >
      </div>
      <div class="form-group" style="display: flex; gap: 8px; flex-wrap: wrap">
        <button class="nav-btn" onclick="saveConfig()">Save changes</button>
        <button class="nav-btn" onclick="toggleConfigPanel()">Cancel</button>
      </div>
    </div>

    <footer dir="rtl" style="text-align: center; font-family: inherit">
      <p>
        <a href="https://t.me/ITG_KSA" target="_blank" rel="noopener">
          chatgpt.com ملتقى التعليم التفاعلي بالتعاون مع
        </a>
      </p>
      <p>عارض الأسئلة التفاعلية العام لمادة اللغة الانجليزية| 1447هـ/2025م</p>
    </footer>

    <script>
      // ======== App State ========
      const state = {
        questions: [],
        currentQuestion: 0,
        score: 0,
        timeLeft: 30,
        questionTime: 30,
        timerId: null,
        isPaused: false,
        answeredQuestions: [],
        lastWrong: [],
        numeralType: "arabic", // default for English
        shuffledMaps: [],
      };

      const quizConfig = {
        title: "General Quiz - Lite",
        instructions:
          "Select the correct answer for each question before time runs out.",
      };

      const STORAGE_KEY = "quiz-progress-lite-en-v1";

      const fmtArabic = new Intl.NumberFormat("ar-EG"); // Eastern digits
      const fmtLatin = new Intl.NumberFormat("en-US"); // Latin digits
      function formatNumber(n) {
        return state.numeralType === "eastern"
          ? fmtArabic.format(n)
          : fmtLatin.format(n);
      }

      // ======== Sanitization & Text Utilities ========
      function sanitizeHTML(html) {
        if (!window.DOMPurify) return html || "";
        return DOMPurify.sanitize(html || "", {
          ADD_TAGS: [
            "a",
            "u",
            "mark",
            "blockquote",
            "hr",
            "pre",
            "code",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "ul",
            "ol",
            "li",
            "img",
            "table",
            "thead",
            "tbody",
            "tr",
            "td",
            "th",
            "p",
            "span",
            "div",
            "br",
            "sub",
            "sup",
            "strong",
            "em",
          ],
          ALLOWED_ATTR: [
            "src",
            "alt",
            "style",
            "class",
            "rowspan",
            "colspan",
            "href",
            "target",
            "rel",
            "dir",
            "width",
            "height",
          ],
          ALLOW_DATA_ATTR: false,
          FORBID_ATTR: ["onerror", "onclick"],
        });
      }

      const EASTERN = ["٠", "١", "٢", "٣", "٤", "٥", "٦", "٧", "٨", "٩"];

      function convertNumeralsInText(text) {
        if (!text || typeof text !== "string") return text;
        if (state.numeralType === "eastern")
          return text.replace(/\d/g, (d) => EASTERN[d]);
        return text.replace(/[٠-٩]/g, (d) => EASTERN.indexOf(d));
      }

      function applyNumeralTypeToPage() {
        const SKIP = new Set(["SCRIPT", "STYLE", "TEXTAREA", "INPUT"]);
        function walk(node) {
          if (node.nodeType === Node.TEXT_NODE) {
            node.nodeValue = convertNumeralsInText(node.nodeValue);
          } else if (
            node.nodeType === Node.ELEMENT_NODE &&
            !SKIP.has(node.tagName)
          ) {
            for (let i = 0; i < node.childNodes.length; i++)
              walk(node.childNodes[i]);
          }
        }
        const targets = [
          document.body,
          document.getElementById("readingText"),
          document.getElementById("question"),
          document.getElementById("options"),
          document.getElementById("scoreBoard"),
          document.getElementById("quizTitle"),
          document.getElementById("instructions"),
          document.getElementById("quizFooter"),
        ];
        targets.forEach((el) => {
          if (el) walk(el);
        });

        const fs = document.getElementById("finalScore");
        const tq = document.getElementById("totalQuestions");
        if (fs) fs.textContent = convertNumeralsInText(fs.textContent);
        if (tq) tq.textContent = convertNumeralsInText(tq.textContent);
      }

      // Strict plain-text -> HTML (supports ///, //, and lead-in bullets/numbers)
      function plainToHTMLStrict(src) {
        if (!src || typeof src !== "string") return "";
        const ESC = (s) =>
          s.replace(
            /[&<>]/g,
            (m) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[m])
          );
        const lines = src.split(/\r?\n/);
        const out = [];
        for (let raw of lines) {
          let s = raw.trim();
          if (!s) {
            out.push("<p>&nbsp;</p>");
            continue;
          }
          if (/^\/\/\/+$/.test(s)) {
            out.push("<hr>");
            continue;
          }
          s = ESC(s).replace(/(?:\s*\/\/\s*)+/g, "<br>");
          const m = s.match(
            /^(\*+|[\-\u2212\u2013\u2014]|[\(\[]?[0-9٠-٩]+[\)\.\-:]|[IVXLC]+[\)\.\:])\s+(.*)$/i
          );
          if (m) {
            const head = m[1],
              rest = m[2];
            s = `<span class="lead-in">${head}</span> ${rest}`;
          }
          out.push(`<p>${s}</p>`);
        }
        if (!out.length) out.push("<p>&nbsp;</p>");
        return out.join("");
      }

      // Uses HTML when present; otherwise converts plain text with shortcuts
      function formatQuizContent(html) {
        if (!html || typeof html !== "string") return "";
        const looksHTML = /<\/?[a-z][\s\S]*>/i.test(html);
        const rendered = looksHTML ? html : plainToHTMLStrict(html);

        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = rendered;

        (function walk(node) {
          if (node.nodeType === Node.TEXT_NODE) {
            node.nodeValue = convertNumeralsInText(node.nodeValue);
          } else if (node.nodeType === Node.ELEMENT_NODE) {
            for (let i = 0; i < node.childNodes.length; i++)
              walk(node.childNodes[i]);
          }
        })(tempDiv);

        return sanitizeHTML(tempDiv.innerHTML);
      }

      // Title & instructions helpers (HTML allowed; // and /// in plain)
      function formatHeader(input) {
        if (!input || typeof input !== "string") return "";
        const looksHTML = /<\/?[a-z][\s\S]*>/i.test(input);
        if (looksHTML) return sanitizeHTML(input);
        let s = input.replace(/(?:\s*\/\/\s*)+/g, "<br>");
        return sanitizeHTML(s);
      }
      function formatSubheader(input) {
        if (!input || typeof input !== "string") return "";
        const looksHTML = /<\/?[a-z][\s\S]*>/i.test(input);
        if (looksHTML) return sanitizeHTML(input);
        const out = input
          .split(/\r?\n/)
          .map((line) => {
            const t = line.trim();
            if (/^\/\/\/+$/.test(t)) return "<hr>";
            return line.replace(/(?:\s*\/\/\s*)+/g, "<br>");
          })
          .join("<br>");
        return sanitizeHTML(out);
      }

      // ======== Persistence ========
      function persist() {
        try {
          const payload = {
            currentQuestion: state.currentQuestion,
            score: state.score,
            timeLeft: state.timeLeft,
            questionTime: state.questionTime,
            answeredQuestions: state.answeredQuestions,
            lastWrong: state.lastWrong,
            numeralType: state.numeralType,
            shuffledMaps: state.shuffledMaps,
            questions: state.questions,
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        } catch {}
      }

      function restore() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const p = JSON.parse(raw);
          [
            "currentQuestion",
            "score",
            "timeLeft",
            "questionTime",
            "numeralType",
          ].forEach((k) => {
            if (p[k] !== undefined) state[k] = p[k];
          });
          if (Array.isArray(p.answeredQuestions))
            state.answeredQuestions = p.answeredQuestions;
          if (Array.isArray(p.lastWrong)) state.lastWrong = p.lastWrong;
          if (Array.isArray(p.shuffledMaps))
            state.shuffledMaps = p.shuffledMaps;
          if (Array.isArray(p.questions) && p.questions.length)
            state.questions = p.questions;
        } catch {}
      }

      // ======== Quiz Core ========
      function shuffleOptionsOnce(qIndex) {
        if (state.shuffledMaps[qIndex]) return state.shuffledMaps[qIndex];
        const q = state.questions[qIndex];
        const map = (q.options || []).map((_, i) => i);
        for (let i = map.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [map[i], map[j]] = [map[j], map[i]];
        }
        state.shuffledMaps[qIndex] = map;
        return map;
      }

      function startTimer() {
        clearInterval(state.timerId);
        const endAt = Date.now() + state.questionTime * 1000;
        state.timerId = setInterval(() => {
          if (state.isPaused) return;
          const remain = Math.max(0, Math.ceil((endAt - Date.now()) / 1000));
          state.timeLeft = remain;
          updateTimerDisplay();
          if (remain <= 0) {
            clearInterval(state.timerId);
            nextQuestion();
          }
        }, 200);
      }

      function updateTimerDisplay() {
        document.getElementById(
          "timer"
        ).textContent = `Time left: ${formatNumber(state.timeLeft)} seconds`;
      }
      function updateQuestionCounter() {
        document.getElementById(
          "questionCounter"
        ).textContent = `Question ${formatNumber(
          state.currentQuestion + 1
        )} of ${formatNumber(state.questions.length)}`;
      }
      function updateScoreCounter() {
        document.getElementById(
          "scoreCounter"
        ).textContent = `Score: ${formatNumber(state.score)} of ${formatNumber(
          state.questions.length
        )}`;
      }

      function init(skipRestore = false) {
        if (!skipRestore) restore();

        document.getElementById("numeralType").value = state.numeralType;
        document.getElementById("questionTime").value = state.questionTime;

        // Title & instructions (support HTML/plain shortcuts)
        document.getElementById("quizTitle").innerHTML = formatHeader(
          quizConfig.title
        );
        document.getElementById("instructions").innerHTML = formatSubheader(
          quizConfig.instructions
        );

        if (state.questions.length === 0) {
          document.getElementById(
            "questionCounter"
          ).textContent = `Question ${formatNumber(0)} of ${formatNumber(0)}`;
          document.getElementById(
            "timer"
          ).textContent = `Time left: ${formatNumber(state.timeLeft)} seconds`;
          document.getElementById(
            "scoreCounter"
          ).textContent = `Score: ${formatNumber(0)} of ${formatNumber(0)}`;
          return;
        }

        if (
          !Array.isArray(state.answeredQuestions) ||
          state.answeredQuestions.length !== state.questions.length
        ) {
          state.answeredQuestions = new Array(state.questions.length).fill(
            null
          );
          state.lastWrong = new Array(state.questions.length).fill(null);
        }
        showQuestion();
      }

      function showQuestion() {
        clearInterval(state.timerId);
        state.timeLeft = state.questionTime;

        const readingTextElement = document.getElementById("readingText");
        const questionElement = document.getElementById("question");
        const optionsElement = document.getElementById("options");

        if (state.currentQuestion >= state.questions.length) {
          showResult();
          return;
        }

        const q = state.questions[state.currentQuestion];
        // Ensure valid correct answer index
        if (
          !Array.isArray(q.options) ||
          q.options.length === 0 ||
          typeof q.correct !== "number" ||
          q.correct < 0 ||
          q.correct >= q.options.length
        ) {
          q.correct = 0;
        }

        // ----- القراءة -----
        readingTextElement.innerHTML = "";
        let readingTextContent = "",
          readingImageSrc = null;
        if (q.reading) {
          readingTextContent = q.reading.text || "";
          readingImageSrc = q.reading.image || null;
        } else if (q.readingText) {
          readingTextContent =
            typeof q.readingText === "string"
              ? q.readingText
              : q.readingText.text || "";
          readingImageSrc =
            typeof q.readingText === "object"
              ? q.readingText.image || null
              : null;
        } else if (q.paragraph) {
          readingTextContent = q.paragraph;
          readingImageSrc = q.paragraphImage || null;
        }

        if (readingTextContent || readingImageSrc) {
          readingTextElement.style.display = "block";
          if (readingTextContent) {
            const d = document.createElement("div");
            d.className = "reading-text-content";
            d.innerHTML = formatQuizContent(readingTextContent);
            readingTextElement.appendChild(d);
          }
          if (readingImageSrc) {
            const img = document.createElement("img");
            img.src = readingImageSrc;
            img.className = "reading-text-image";
            img.alt = "صورة النص القرائي";
            readingTextElement.appendChild(img);
            img.alt = "Reading image";
            img.loading = "lazy";
            img.decoding = "async";
          }
        } else {
          readingTextElement.style.display = "none";
        }

        // ----- السؤال -----
        questionElement.innerHTML = "";
        const questionContent = document.createElement("div");
        questionContent.className = "question-content";

        if (q.question?.text) {
          const d = document.createElement("div");
          d.className = "question-text";
          d.innerHTML = formatQuizContent(q.question.text);
          questionContent.appendChild(d);
        }
        if (q.question?.image) {
          const i = document.createElement("img");
          i.src = q.question.image;
          i.className = "question-image";
          i.alt = "Question image";
          i.loading = "lazy";
          i.decoding = "async";
          questionContent.appendChild(i);
        }
        questionElement.appendChild(questionContent);

        // ----- الخيارات -----
        optionsElement.innerHTML = "";
        optionsElement.setAttribute("role", "radiogroup");
        if (!q.options || q.options.length === 0) {
          console.warn("لا توجد خيارات لهذا السؤال");
          return;
        }

        const map = shuffleOptionsOnce(state.currentQuestion);
        const valid = [];
        map.forEach((origIdx) => {
          const opt = q.options[origIdx];
          if (!opt || (!opt.text && !opt.image)) return;

          const wrap = document.createElement("div");
          wrap.className = "option";
          wrap.setAttribute("role", "radio");
          wrap.setAttribute("tabindex", "0");
          wrap.setAttribute("aria-checked", "false");

          const content = document.createElement("div");
          content.className = "option-content";

          if (opt.image) {
            const img = document.createElement("img");
            img.src = opt.image;
            img.className = "option-image";
            img.alt = "Option image";
            img.loading = "lazy";
            img.decoding = "async";
            content.appendChild(img);
          }
          if (opt.text) {
            const span = document.createElement("span");
            span.className = "option-text";
            span.innerHTML = formatQuizContent(opt.text);
            content.appendChild(span);
          }

          wrap.appendChild(content);

          if (state.answeredQuestions[state.currentQuestion] !== null) {
            wrap.setAttribute("aria-disabled", "true");
            if (origIdx === q.correct) wrap.classList.add("correct");
            if (
              state.answeredQuestions[state.currentQuestion] === false &&
              state.lastWrong[state.currentQuestion] === origIdx
            ) {
              wrap.classList.add("wrong");
            }
          }

          wrap.onclick = () => checkAnswer(origIdx);
          wrap.onkeydown = (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              checkAnswer(origIdx);
              return;
            }
            if (
              e.key === "ArrowRight" ||
              e.key === "ArrowDown" ||
              e.key === "ArrowLeft" ||
              e.key === "ArrowUp"
            ) {
              const items = Array.from(
                document.querySelectorAll("#options .option")
              );
              const idx = items.indexOf(wrap);
              let next = idx;
              if (e.key === "ArrowRight" || e.key === "ArrowDown") next++;
              else next--;
              if (next < 0) next = items.length - 1;
              if (next >= items.length) next = 0;
              const el = items[next];
              if (el) el.focus();
            }
          };

          valid.push(wrap);
        });

        optionsElement.classList.remove(
          "options-row",
          "options-two",
          "options-three"
        );
        if (valid.length <= 3) {
          optionsElement.classList.add("options-row");
          if (valid.length === 2) optionsElement.classList.add("options-two");
          else if (valid.length === 3)
            optionsElement.classList.add("options-three");
        }
        valid.forEach((v) => optionsElement.appendChild(v));

        // أزرار/شريط التقدّم + المؤشرات
        document.getElementById("prevBtn").disabled =
          state.currentQuestion === 0;
        document.getElementById("nextBtn").disabled = false;

        const progressEl = document.getElementById("progress");
        if (progressEl) {
          const total = Array.isArray(state.questions)
            ? state.questions.length
            : 0;
          const pct = total > 0 ? (state.currentQuestion / total) * 100 : 0;
          progressEl.style.width = pct + "%"; // انتبه أنها % الإنجليزية
        }

        updateQuestionCounter();
        updateScoreCounter();
        updateTimerDisplay();
        startTimer();
        persist();
      }

      function checkAnswer(selectedIndex) {
        if (state.answeredQuestions[state.currentQuestion] !== null) return;
        const q = state.questions[state.currentQuestion];
        document.querySelectorAll(".option").forEach((o) => {
          o.setAttribute("aria-disabled", "true");
        });
        const correctIndex = q.correct;
        if (selectedIndex === correctIndex) {
          state.score++;
          state.answeredQuestions[state.currentQuestion] = true;
        } else {
          state.answeredQuestions[state.currentQuestion] = false;
          state.lastWrong[state.currentQuestion] = selectedIndex;
        }
        const map = state.shuffledMaps[state.currentQuestion] || [];
        document.querySelectorAll(".option").forEach((el, i) => {
          const origIdx = map[i];
          if (origIdx === correctIndex) el.classList.add("correct");
          if (
            state.answeredQuestions[state.currentQuestion] === false &&
            origIdx === state.lastWrong[state.currentQuestion]
          )
            el.classList.add("wrong");
          el.setAttribute("aria-checked", String(origIdx === selectedIndex));
        });
        updateScoreCounter();
        persist();
        if (state.currentQuestion < state.questions.length - 1)
          setTimeout(nextQuestion, 1000);
        else setTimeout(showResult, 1000);
      }

      function nextQuestion() {
        if (state.currentQuestion >= state.questions.length - 1) {
          showResult();
          return;
        }
        state.currentQuestion++;
        showQuestion();
      }
      function previousQuestion() {
        if (state.currentQuestion > 0) {
          state.currentQuestion--;
          showQuestion();
        }
      }

      function showResult() {
        clearInterval(state.timerId);
        document.querySelector(".quiz-box").style.display = "none";
        document.getElementById("scoreBoard").style.display = "block";
        document.getElementById("teacherButtons").style.display = "none";
        document.getElementById("readingText").style.display = "none";
        document.getElementById("countersBox").style.display = "none";

        document.getElementById("finalScore").textContent = formatNumber(
          state.score
        );
        document.getElementById("totalQuestions").textContent = formatNumber(
          state.questions.length
        );

        applyNumeralTypeToPage();
        persist();
      }

      function restartQuiz() {
        state.currentQuestion = 0;
        state.score = 0;
        state.timeLeft = state.questionTime;
        state.answeredQuestions = new Array(state.questions.length).fill(null);
        state.lastWrong = new Array(state.questions.length).fill(null);
        document.querySelector(".quiz-box").style.display = "block";
        document.getElementById("scoreBoard").style.display = "none";
        document.getElementById("teacherButtons").style.display = "flex";
        document.getElementById("countersBox").style.display = "flex";
        const progress = document.getElementById("progress");
        if (progress) progress.style.width = "0%";
        document.querySelectorAll(".option").forEach((o) => {
          o.classList.remove("correct", "wrong");
          o.removeAttribute("aria-disabled");
        });
        showQuestion();
      }

      function togglePause() {
        state.isPaused = !state.isPaused;
        const b = document.getElementById("pauseBtn");
        b.textContent = state.isPaused ? "Resume" : "Pause";
        b.style.background = state.isPaused ? "#28a745" : "#ffc107";
      }

      function toggleSettingsPanel() {
        const p = document.getElementById("settingsPanel");
        p.style.display = p.style.display === "block" ? "none" : "block";
        persist();
      }

      function toggleConfigPanel() {
        const p = document.getElementById("configPanel");
        if (p.style.display === "block") {
          p.style.display = "none";
        } else {
          p.style.display = "block";
          document.getElementById("titleInput").value = quizConfig.title;
          document.getElementById("instructionsInput").value =
            quizConfig.instructions;
          document.getElementById("footerInput").value =
            document.getElementById("quizFooter").textContent;
        }
      }

      function saveConfig() {
        const newTitle = document.getElementById("titleInput").value?.trim();
        const newInstructions = document
          .getElementById("instructionsInput")
          .value?.trim();
        const newFooter = document.getElementById("footerInput").value?.trim();
        if (newTitle) {
          quizConfig.title = newTitle;
          document.getElementById("quizTitle").innerHTML =
            formatHeader(newTitle);
        }
        if (newInstructions) {
          quizConfig.instructions = newInstructions;
          document.getElementById("instructions").innerHTML =
            formatSubheader(newInstructions);
        }
        if (newFooter) {
          document.getElementById("quizFooter").innerHTML =
            sanitizeHTML(newFooter);
        }
        toggleConfigPanel();
        persist();
      }

      function changeNumeralType() {
        state.numeralType = document.getElementById("numeralType").value;
        updateQuestionCounter();
        updateScoreCounter();
        updateTimerDisplay();
        applyNumeralTypeToPage();
        persist();
      }

      function changeQuestionTime() {
        const v = parseInt(document.getElementById("questionTime").value, 10);
        if (v >= 5 && v <= 180) {
          state.questionTime = v;
          state.timeLeft = v;
          updateTimerDisplay();
          persist();
        }
      }

      function cleanEasternNumerals() {
        if (!Array.isArray(state.questions)) return;
        function eastToLatin(t) {
          return (t || "")
            .toString()
            .replace(/[٠-٩]/g, (d) => EASTERN.indexOf(d));
        }
        state.questions.forEach((q) => {
          if (q.reading?.text) q.reading.text = eastToLatin(q.reading.text);
          if (
            q.readingText &&
            typeof q.readingText === "object" &&
            q.readingText.text
          )
            q.readingText.text = eastToLatin(q.readingText.text);
          if (q.paragraph) q.paragraph = eastToLatin(q.paragraph);
          if (q.question?.text) q.question.text = eastToLatin(q.question.text);
          if (Array.isArray(q.options))
            q.options.forEach((o) => {
              if (o?.text) o.text = eastToLatin(o.text);
            });
        });
        alert("✅ Eastern digits cleaned successfully!");
        showQuestion();
        persist();
      }

      function loadQuestionsFromFile() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = JSON.parse(evt.target.result);
              if (!Array.isArray(data)) throw new Error("Invalid format");

              localStorage.removeItem(STORAGE_KEY);

              state.questions = JSON.parse(JSON.stringify(data));
              state.currentQuestion = 0;
              state.score = 0;
              state.timeLeft = state.questionTime;
              state.shuffledMaps = [];
              // normalize correctness indexes inside loaded data
              state.questions.forEach((qq) => {
                if (!Array.isArray(qq.options)) qq.options = [];
                if (
                  typeof qq.correct !== "number" ||
                  qq.correct < 0 ||
                  qq.correct >= qq.options.length
                ) {
                  qq.correct = 0;
                }
              });
              state.answeredQuestions = new Array(state.questions.length).fill(
                null
              );
              state.lastWrong = new Array(state.questions.length).fill(null);

              init(true);
              persist();
            } catch (err) {
              alert(
                "Error while loading questions. Please check the JSON format."
              );
              console.error(err);
            }
          };
          reader.readAsText(file);
        };
        input.click();
      }

      function saveQuestionsToFile() {
        if (!Array.isArray(state.questions) || state.questions.length === 0) {
          alert("No questions to save!");
          return;
        }
        const dataStr = JSON.stringify(state.questions, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "quiz_questions.json";
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 100);
      }

      // ======== Edit Mode ========
      function toggleEditMode() {
        const editPanel = document.getElementById("editPanel");
        const quizBox = document.querySelector(".quiz-box");
        const countersBox = document.getElementById("countersBox");
        const readingText = document.getElementById("readingText");

        if (!Array.isArray(state.questions) || state.questions.length === 0) {
          alert("Please load questions first!");
          return;
        }

        if (editPanel.style.display === "block") {
          editPanel.style.display = "none";
          quizBox.style.display = "block";
          countersBox.style.display = "flex";
          const q = state.questions[state.currentQuestion];
          const hasReading = q && (q.reading || q.readingText || q.paragraph);
          readingText.style.display = hasReading ? "block" : "none";
          startTimer();
          return;
        }

        clearInterval(state.timerId);
        editPanel.style.display = "block";
        quizBox.style.display = "none";
        countersBox.style.display = "none";
        readingText.style.display = "none";

        populateEditForm();
      }

      function populateEditForm() {
        const q = state.questions[state.currentQuestion];
        if (!q) return;

        let readingText = "";
        let readingImage = null;
        if (q.reading) {
          readingText = q.reading.text || "";
          readingImage = q.reading.image || null;
        } else if (q.readingText) {
          readingText =
            typeof q.readingText === "string"
              ? q.readingText
              : q.readingText.text || "";
          readingImage =
            typeof q.readingText === "object"
              ? q.readingText.image || null
              : null;
        } else if (q.paragraph) {
          readingText = q.paragraph || "";
          readingImage = q.paragraphImage || null;
        }

        document.getElementById("editReadingText").value = readingText || "";
        const rPrev = document.getElementById("readingImagePreview");
        rPrev.src = readingImage || "";
        rPrev.style.display = readingImage ? "block" : "none";

        document.getElementById("editQuestionText").value =
          q.question && q.question.text ? q.question.text : "";
        const qPrev = document.getElementById("questionImagePreview");
        qPrev.src = q.question && q.question.image ? q.question.image : "";
        qPrev.style.display = q.question && q.question.image ? "block" : "none";

        for (let i = 0; i < 4; i++) {
          const opt =
            q.options && q.options[i]
              ? q.options[i]
              : { text: "", image: null };
          const t = document.getElementById("editOption" + (i + 1));
          const p = document.getElementById("optionImagePreview" + (i + 1));
          const c = document.getElementById("correct" + (i + 1));
          if (t) t.value = opt.text || "";
          if (p) {
            p.src = opt.image || "";
            p.style.display = opt.image ? "block" : "none";
          }
          if (c) c.checked = i === (q.correct || 0);
        }
      }

      function handleImageUpload(input, previewId, setter) {
        const file = input.files && input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          const data = e.target.result;
          const prev = document.getElementById(previewId);
          if (prev) {
            prev.src = data;
            prev.style.display = "block";
          }
          try {
            setter(data);
            persist();
          } catch {}
        };
        reader.readAsDataURL(file);
      }

      function attachEditPanelEvents() {
        const rImg = document.getElementById("editReadingImage");
        if (rImg)
          rImg.onchange = function () {
            const q = state.questions[state.currentQuestion];
            handleImageUpload(this, "readingImagePreview", (base64) => {
              if (q.reading) {
                q.reading.image = base64;
              } else if (q.readingText && typeof q.readingText === "object") {
                q.readingText.image = base64;
              } else {
                q.paragraphImage = base64;
              }
            });
          };

        const qImg = document.getElementById("editQuestionImage");
        if (qImg)
          qImg.onchange = function () {
            const q = state.questions[state.currentQuestion];
            if (!q.question) q.question = { text: "", image: null };
            handleImageUpload(this, "questionImagePreview", (base64) => {
              q.question.image = base64;
            });
          };

        for (let i = 1; i <= 4; i++) {
          const optImg = document.getElementById("editOptionImage" + i);
          if (optImg)
            optImg.onchange = (function (ii) {
              return function () {
                const q = state.questions[state.currentQuestion];
                if (!q.options) q.options = [];
                if (!q.options[ii - 1])
                  q.options[ii - 1] = { text: "", image: null };
                handleImageUpload(this, "optionImagePreview" + ii, (base64) => {
                  q.options[ii - 1].image = base64;
                });
              };
            })(i);

          const corr = document.getElementById("correct" + i);
          if (corr)
            corr.onchange = (function (ii) {
              return function () {
                if (!this.checked) return;
                for (let j = 1; j <= 4; j++) {
                  const c = document.getElementById("correct" + j);
                  if (c) c.checked = j === ii;
                }
                const q = state.questions[state.currentQuestion];
                q.correct = ii - 1;
                persist();
              };
            })(i);
        }
      }

      function saveEdit() {
        const q = state.questions[state.currentQuestion];
        if (!q) return;

        const readingText = (
          document.getElementById("editReadingText").value || ""
        ).trim();
        const questionText = (
          document.getElementById("editQuestionText").value || ""
        ).trim();
        const options = [
          (document.getElementById("editOption1").value || "").trim(),
          (document.getElementById("editOption2").value || "").trim(),
          (document.getElementById("editOption3").value || "").trim(),
          (document.getElementById("editOption4").value || "").trim(),
        ];
        const nonEmpty = options.filter(Boolean).length;
        const correctIndex = [1, 2, 3, 4]
          .map((i) =>
            document.getElementById("correct" + i).checked ? i - 1 : -1
          )
          .find((x) => x !== -1);

        if (!questionText) {
          alert("Please enter the question text!");
          return;
        }
        if (nonEmpty < 2) {
          alert("Please enter at least two non-empty options!");
          return;
        }
        if (
          correctIndex === undefined ||
          correctIndex < 0 ||
          !options[correctIndex]
        ) {
          alert(
            "Please select one correct answer, and make sure it is not empty!"
          );
          return;
        }

        if (q.reading) {
          q.reading.text = readingText;
        } else if (q.readingText) {
          if (typeof q.readingText === "string") q.readingText = readingText;
          else q.readingText.text = readingText;
        } else {
          q.paragraph = readingText;
        }

        if (!q.question) q.question = { text: "", image: null };
        q.question.text = questionText;

        if (!Array.isArray(q.options)) q.options = [];
        for (let i = 0; i < 4; i++) {
          if (!q.options[i]) q.options[i] = { text: "", image: null };
          q.options[i].text = options[i] || "";
        }
        q.correct = correctIndex;

        document.getElementById("editPanel").style.display = "none";
        document.querySelector(".quiz-box").style.display = "block";
        document.getElementById("countersBox").style.display = "flex";

        const hasReading =
          q && (q.reading || q.readingText || q.paragraph || q.paragraphImage);
        document.getElementById("readingText").style.display = hasReading
          ? "block"
          : "none";

        showQuestion();
        persist();
      }

      function cancelEdit() {
        document.getElementById("editPanel").style.display = "none";
        document.querySelector(".quiz-box").style.display = "block";
        document.getElementById("countersBox").style.display = "flex";
        const q = state.questions[state.currentQuestion];
        const hasReading =
          q && (q.reading || q.readingText || q.paragraph || q.paragraphImage);
        document.getElementById("readingText").style.display = hasReading
          ? "block"
          : "none";
        startTimer();
      }

      function addNewQuestion() {
        const newQ = {
          reading: { text: "", image: null },
          question: { text: "", image: null },
          options: [
            { text: "", image: null },
            { text: "", image: null },
            { text: "", image: null },
            { text: "", image: null },
          ],
          correct: 0,
        };
        state.questions.push(newQ);
        state.currentQuestion = state.questions.length - 1;
        if (
          !Array.isArray(state.answeredQuestions) ||
          state.answeredQuestions.length !== state.questions.length
        ) {
          state.answeredQuestions = new Array(state.questions.length).fill(
            null
          );
          state.lastWrong = new Array(state.questions.length).fill(null);
        } else {
          state.answeredQuestions.push(null);
          state.lastWrong.push(null);
        }
        document.getElementById("editPanel").style.display = "none";
        document.querySelector(".quiz-box").style.display = "block";
        document.getElementById("countersBox").style.display = "flex";
        showQuestion();
        persist();
      }

      function deleteCurrentQuestion() {
        if (!Array.isArray(state.questions) || state.questions.length <= 1) {
          alert("Cannot delete the only question!");
          return;
        }
        if (!confirm("Are you sure you want to delete this question?")) return;

        state.questions.splice(state.currentQuestion, 1);
        if (Array.isArray(state.answeredQuestions))
          state.answeredQuestions.splice(state.currentQuestion, 1);
        if (Array.isArray(state.lastWrong))
          state.lastWrong.splice(state.currentQuestion, 1);
        if (Array.isArray(state.shuffledMaps))
          state.shuffledMaps.splice(state.currentQuestion, 1);

        if (state.currentQuestion >= state.questions.length)
          state.currentQuestion = state.questions.length - 1;

        document.getElementById("editPanel").style.display = "none";
        document.querySelector(".quiz-box").style.display = "block";
        document.getElementById("countersBox").style.display = "flex";
        const q = state.questions[state.currentQuestion];
        const hasReading = q && (q.reading || q.readingText || q.paragraph);
        document.getElementById("readingText").style.display = hasReading
          ? "block"
          : "none";
        showQuestion();
        persist();
      }

      window.addEventListener("load", attachEditPanelEvents);

      // ======== Save Student Version (Lite) ========
      function saveAppForOfflineUse() {
        try {
          const teacherHTML = document.documentElement.cloneNode(true);
          const doc = teacherHTML.ownerDocument;

          const removeSelectors = [
            ".config-btn",
            ".buttons-container",
            ".settings-panel",
            ".config-panel",
            "#editPanel",
            "#editButton",
            "#settingsBtn",
            "#loadButton",
            "#saveQuestionsButton",
            "#saveAppButton",
            "#resetProgressBtn",
          ];
          removeSelectors.forEach((sel) =>
            teacherHTML.querySelectorAll(sel).forEach((el) => el.remove())
          );

          const scoreBoard = teacherHTML.querySelector("#scoreBoard");
          if (scoreBoard) scoreBoard.style.display = "none";
          const quizBox = teacherHTML.querySelector(".quiz-box");
          if (quizBox) quizBox.style.display = "block";
          const counters = teacherHTML.querySelector("#countersBox");
          if (counters) counters.style.display = "flex";
          const readingTextBox = teacherHTML.querySelector("#readingText");
          if (readingTextBox) readingTextBox.style.display = "none";

          const cleanQuestions = JSON.parse(
            JSON.stringify(state.questions ?? [])
          );
          const numeral =
            state.numeralType === "eastern" ? "eastern" : "arabic";
          const qTime = Number(state.questionTime) || 30;

          const EAST = ["٠", "١", "٢", "٣", "٤", "٥", "٦", "٧", "٨", "٩"];
          const toEastern = (s) =>
            (s ?? "").toString().replace(/\d/g, (d) => EAST[d]);
          const toLatin = (s) =>
            (s ?? "").toString().replace(/[٠-٩]/g, (d) => EAST.indexOf(d));

          function normalizeData(qs, style) {
            const conv = style === "eastern" ? toEastern : toLatin;
            qs.forEach((q) => {
              if (q.reading?.text) q.reading.text = conv(q.reading.text);
              if (typeof q.readingText === "string")
                q.readingText = conv(q.readingText);
              else if (
                q.readingText &&
                typeof q.readingText === "object" &&
                q.readingText.text
              )
                q.readingText.text = conv(q.readingText.text);
              if (q.paragraph) q.paragraph = conv(q.paragraph);
              if (q.question?.text) q.question.text = conv(q.question.text);
              (q.options || []).forEach((o) => {
                if (o?.text) o.text = conv(o.text);
              });
            });
          }
          normalizeData(cleanQuestions, numeral);

          const head = teacherHTML.querySelector("head");
          const needScript = (needle) =>
            ![...teacherHTML.querySelectorAll("script[src]")].some((s) =>
              s.src.includes(needle)
            );
          if (needScript("purify")) {
            const dp = doc.createElement("script");
            dp.src =
              "data:text/javascript;base64,LyohIEBsaWNlbnNlIERPTVB1cmlmeSAzLjEuNiB8IChjKSBDdXJlNTMgYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IFJlbGVhc2VkIHVuZGVyIHRoZSBBcGFjaGUgbGljZW5zZSAyLjAgYW5kIE1vemlsbGEgUHVibGljIExpY2Vuc2UgMi4wIHwgZ2l0aHViLmNvbS9jdXJlNTMvRE9NUHVyaWZ5L2Jsb2IvMy4xLjYvTElDRU5TRSAqLwohZnVuY3Rpb24oZSx0KXsib2JqZWN0Ij09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT10eXBlb2YgbW9kdWxlP21vZHVsZS5leHBvcnRzPXQoKToiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZSh0KTooZT0idW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpczplfHxzZWxmKS5ET01QdXJpZnk9dCgpfSh0aGlzLChmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijtjb25zdHtlbnRyaWVzOmUsc2V0UHJvdG90eXBlT2Y6dCxpc0Zyb3plbjpuLGdldFByb3RvdHlwZU9mOm8sZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOnJ9PU9iamVjdDtsZXR7ZnJlZXplOmksc2VhbDphLGNyZWF0ZTpsfT1PYmplY3Qse2FwcGx5OmMsY29uc3RydWN0OnN9PSJ1bmRlZmluZWQiIT10eXBlb2YgUmVmbGVjdCYmUmVmbGVjdDtpfHwoaT1mdW5jdGlvbihlKXtyZXR1cm4gZX0pLGF8fChhPWZ1bmN0aW9uKGUpe3JldHVybiBlfSksY3x8KGM9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBlLmFwcGx5KHQsbil9KSxzfHwocz1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgZSguLi50KX0pO2NvbnN0IHU9YihBcnJheS5wcm90b3R5cGUuZm9yRWFjaCksbT1iKEFycmF5LnByb3RvdHlwZS5wb3ApLHA9YihBcnJheS5wcm90b3R5cGUucHVzaCksZj1iKFN0cmluZy5wcm90b3R5cGUudG9Mb3dlckNhc2UpLGQ9YihTdHJpbmcucHJvdG90eXBlLnRvU3RyaW5nKSxoPWIoU3RyaW5nLnByb3RvdHlwZS5tYXRjaCksZz1iKFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSksVD1iKFN0cmluZy5wcm90b3R5cGUuaW5kZXhPZikseT1iKFN0cmluZy5wcm90b3R5cGUudHJpbSksRT1iKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkpLF89YihSZWdFeHAucHJvdG90eXBlLnRlc3QpLEE9KE49VHlwZUVycm9yLGZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSksbj0wO248ZTtuKyspdFtuXT1hcmd1bWVudHNbbl07cmV0dXJuIHMoTix0KX0pO3ZhciBOO2Z1bmN0aW9uIGIoZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgbj1hcmd1bWVudHMubGVuZ3RoLG89bmV3IEFycmF5KG4+MT9uLTE6MCkscj0xO3I8bjtyKyspb1tyLTFdPWFyZ3VtZW50c1tyXTtyZXR1cm4gYyhlLHQsbyl9fWZ1bmN0aW9uIFMoZSxvKXtsZXQgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06Zjt0JiZ0KGUsbnVsbCk7bGV0IGk9by5sZW5ndGg7Zm9yKDtpLS07KXtsZXQgdD1vW2ldO2lmKCJzdHJpbmciPT10eXBlb2YgdCl7Y29uc3QgZT1yKHQpO2UhPT10JiYobihvKXx8KG9baV09ZSksdD1lKX1lW3RdPSEwfXJldHVybiBlfWZ1bmN0aW9uIFIoZSl7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspe0UoZSx0KXx8KGVbdF09bnVsbCl9cmV0dXJuIGV9ZnVuY3Rpb24gdyh0KXtjb25zdCBuPWwobnVsbCk7Zm9yKGNvbnN0W28scl1vZiBlKHQpKXtFKHQsbykmJihBcnJheS5pc0FycmF5KHIpP25bb109UihyKTpyJiYib2JqZWN0Ij09dHlwZW9mIHImJnIuY29uc3RydWN0b3I9PT1PYmplY3Q/bltvXT13KHIpOm5bb109cil9cmV0dXJuIG59ZnVuY3Rpb24gQyhlLHQpe2Zvcig7bnVsbCE9PWU7KXtjb25zdCBuPXIoZSx0KTtpZihuKXtpZihuLmdldClyZXR1cm4gYihuLmdldCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4udmFsdWUpcmV0dXJuIGIobi52YWx1ZSl9ZT1vKGUpfXJldHVybiBmdW5jdGlvbigpe3JldHVybiBudWxsfX1jb25zdCBMPWkoWyJhIiwiYWJiciIsImFjcm9ueW0iLCJhZGRyZXNzIiwiYXJlYSIsImFydGljbGUiLCJhc2lkZSIsImF1ZGlvIiwiYiIsImJkaSIsImJkbyIsImJpZyIsImJsaW5rIiwiYmxvY2txdW90ZSIsImJvZHkiLCJiciIsImJ1dHRvbiIsImNhbnZhcyIsImNhcHRpb24iLCJjZW50ZXIiLCJjaXRlIiwiY29kZSIsImNvbCIsImNvbGdyb3VwIiwiY29udGVudCIsImRhdGEiLCJkYXRhbGlzdCIsImRkIiwiZGVjb3JhdG9yIiwiZGVsIiwiZGV0YWlscyIsImRmbiIsImRpYWxvZyIsImRpciIsImRpdiIsImRsIiwiZHQiLCJlbGVtZW50IiwiZW0iLCJmaWVsZHNldCIsImZpZ2NhcHRpb24iLCJmaWd1cmUiLCJmb250IiwiZm9vdGVyIiwiZm9ybSIsImgxIiwiaDIiLCJoMyIsImg0IiwiaDUiLCJoNiIsImhlYWQiLCJoZWFkZXIiLCJoZ3JvdXAiLCJociIsImh0bWwiLCJpIiwiaW1nIiwiaW5wdXQiLCJpbnMiLCJrYmQiLCJsYWJlbCIsImxlZ2VuZCIsImxpIiwibWFpbiIsIm1hcCIsIm1hcmsiLCJtYXJxdWVlIiwibWVudSIsIm1lbnVpdGVtIiwibWV0ZXIiLCJuYXYiLCJub2JyIiwib2wiLCJvcHRncm91cCIsIm9wdGlvbiIsIm91dHB1dCIsInAiLCJwaWN0dXJlIiwicHJlIiwicHJvZ3Jlc3MiLCJxIiwicnAiLCJydCIsInJ1YnkiLCJzIiwic2FtcCIsInNlY3Rpb24iLCJzZWxlY3QiLCJzaGFkb3ciLCJzbWFsbCIsInNvdXJjZSIsInNwYWNlciIsInNwYW4iLCJzdHJpa2UiLCJzdHJvbmciLCJzdHlsZSIsInN1YiIsInN1bW1hcnkiLCJzdXAiLCJ0YWJsZSIsInRib2R5IiwidGQiLCJ0ZW1wbGF0ZSIsInRleHRhcmVhIiwidGZvb3QiLCJ0aCIsInRoZWFkIiwidGltZSIsInRyIiwidHJhY2siLCJ0dCIsInUiLCJ1bCIsInZhciIsInZpZGVvIiwid2JyIl0pLEQ9aShbInN2ZyIsImEiLCJhbHRnbHlwaCIsImFsdGdseXBoZGVmIiwiYWx0Z2x5cGhpdGVtIiwiYW5pbWF0ZWNvbG9yIiwiYW5pbWF0ZW1vdGlvbiIsImFuaW1hdGV0cmFuc2Zvcm0iLCJjaXJjbGUiLCJjbGlwcGF0aCIsImRlZnMiLCJkZXNjIiwiZWxsaXBzZSIsImZpbHRlciIsImZvbnQiLCJnIiwiZ2x5cGgiLCJnbHlwaHJlZiIsImhrZXJuIiwiaW1hZ2UiLCJsaW5lIiwibGluZWFyZ3JhZGllbnQiLCJtYXJrZXIiLCJtYXNrIiwibWV0YWRhdGEiLCJtcGF0aCIsInBhdGgiLCJwYXR0ZXJuIiwicG9seWdvbiIsInBvbHlsaW5lIiwicmFkaWFsZ3JhZGllbnQiLCJyZWN0Iiwic3RvcCIsInN0eWxlIiwic3dpdGNoIiwic3ltYm9sIiwidGV4dCIsInRleHRwYXRoIiwidGl0bGUiLCJ0cmVmIiwidHNwYW4iLCJ2aWV3Iiwidmtlcm4iXSksdj1pKFsiZmVCbGVuZCIsImZlQ29sb3JNYXRyaXgiLCJmZUNvbXBvbmVudFRyYW5zZmVyIiwiZmVDb21wb3NpdGUiLCJmZUNvbnZvbHZlTWF0cml4IiwiZmVEaWZmdXNlTGlnaHRpbmciLCJmZURpc3BsYWNlbWVudE1hcCIsImZlRGlzdGFudExpZ2h0IiwiZmVEcm9wU2hhZG93IiwiZmVGbG9vZCIsImZlRnVuY0EiLCJmZUZ1bmNCIiwiZmVGdW5jRyIsImZlRnVuY1IiLCJmZUdhdXNzaWFuQmx1ciIsImZlSW1hZ2UiLCJmZU1lcmdlIiwiZmVNZXJnZU5vZGUiLCJmZU1vcnBob2xvZ3kiLCJmZU9mZnNldCIsImZlUG9pbnRMaWdodCIsImZlU3BlY3VsYXJMaWdodGluZyIsImZlU3BvdExpZ2h0IiwiZmVUaWxlIiwiZmVUdXJidWxlbmNlIl0pLE89aShbImFuaW1hdGUiLCJjb2xvci1wcm9maWxlIiwiY3Vyc29yIiwiZGlzY2FyZCIsImZvbnQtZmFjZSIsImZvbnQtZmFjZS1mb3JtYXQiLCJmb250LWZhY2UtbmFtZSIsImZvbnQtZmFjZS1zcmMiLCJmb250LWZhY2UtdXJpIiwiZm9yZWlnbm9iamVjdCIsImhhdGNoIiwiaGF0Y2hwYXRoIiwibWVzaCIsIm1lc2hncmFkaWVudCIsIm1lc2hwYXRjaCIsIm1lc2hyb3ciLCJtaXNzaW5nLWdseXBoIiwic2NyaXB0Iiwic2V0Iiwic29saWRjb2xvciIsInVua25vd24iLCJ1c2UiXSkseD1pKFsibWF0aCIsIm1lbmNsb3NlIiwibWVycm9yIiwibWZlbmNlZCIsIm1mcmFjIiwibWdseXBoIiwibWkiLCJtbGFiZWxlZHRyIiwibW11bHRpc2NyaXB0cyIsIm1uIiwibW8iLCJtb3ZlciIsIm1wYWRkZWQiLCJtcGhhbnRvbSIsIm1yb290IiwibXJvdyIsIm1zIiwibXNwYWNlIiwibXNxcnQiLCJtc3R5bGUiLCJtc3ViIiwibXN1cCIsIm1zdWJzdXAiLCJtdGFibGUiLCJtdGQiLCJtdGV4dCIsIm10ciIsIm11bmRlciIsIm11bmRlcm92ZXIiLCJtcHJlc2NyaXB0cyJdKSxrPWkoWyJtYWN0aW9uIiwibWFsaWduZ3JvdXAiLCJtYWxpZ25tYXJrIiwibWxvbmdkaXYiLCJtc2NhcnJpZXMiLCJtc2NhcnJ5IiwibXNncm91cCIsIm1zdGFjayIsIm1zbGluZSIsIm1zcm93Iiwic2VtYW50aWNzIiwiYW5ub3RhdGlvbiIsImFubm90YXRpb24teG1sIiwibXByZXNjcmlwdHMiLCJub25lIl0pLE09aShbIiN0ZXh0Il0pLEk9aShbImFjY2VwdCIsImFjdGlvbiIsImFsaWduIiwiYWx0IiwiYXV0b2NhcGl0YWxpemUiLCJhdXRvY29tcGxldGUiLCJhdXRvcGljdHVyZWlucGljdHVyZSIsImF1dG9wbGF5IiwiYmFja2dyb3VuZCIsImJnY29sb3IiLCJib3JkZXIiLCJjYXB0dXJlIiwiY2VsbHBhZGRpbmciLCJjZWxsc3BhY2luZyIsImNoZWNrZWQiLCJjaXRlIiwiY2xhc3MiLCJjbGVhciIsImNvbG9yIiwiY29scyIsImNvbHNwYW4iLCJjb250cm9scyIsImNvbnRyb2xzbGlzdCIsImNvb3JkcyIsImNyb3Nzb3JpZ2luIiwiZGF0ZXRpbWUiLCJkZWNvZGluZyIsImRlZmF1bHQiLCJkaXIiLCJkaXNhYmxlZCIsImRpc2FibGVwaWN0dXJlaW5waWN0dXJlIiwiZGlzYWJsZXJlbW90ZXBsYXliYWNrIiwiZG93bmxvYWQiLCJkcmFnZ2FibGUiLCJlbmN0eXBlIiwiZW50ZXJrZXloaW50IiwiZmFjZSIsImZvciIsImhlYWRlcnMiLCJoZWlnaHQiLCJoaWRkZW4iLCJoaWdoIiwiaHJlZiIsImhyZWZsYW5nIiwiaWQiLCJpbnB1dG1vZGUiLCJpbnRlZ3JpdHkiLCJpc21hcCIsImtpbmQiLCJsYWJlbCIsImxhbmciLCJsaXN0IiwibG9hZGluZyIsImxvb3AiLCJsb3ciLCJtYXgiLCJtYXhsZW5ndGgiLCJtZWRpYSIsIm1ldGhvZCIsIm1pbiIsIm1pbmxlbmd0aCIsIm11bHRpcGxlIiwibXV0ZWQiLCJuYW1lIiwibm9uY2UiLCJub3NoYWRlIiwibm92YWxpZGF0ZSIsIm5vd3JhcCIsIm9wZW4iLCJvcHRpbXVtIiwicGF0dGVybiIsInBsYWNlaG9sZGVyIiwicGxheXNpbmxpbmUiLCJwb3BvdmVyIiwicG9wb3ZlcnRhcmdldCIsInBvcG92ZXJ0YXJnZXRhY3Rpb24iLCJwb3N0ZXIiLCJwcmVsb2FkIiwicHViZGF0ZSIsInJhZGlvZ3JvdXAiLCJyZWFkb25seSIsInJlbCIsInJlcXVpcmVkIiwicmV2IiwicmV2ZXJzZWQiLCJyb2xlIiwicm93cyIsInJvd3NwYW4iLCJzcGVsbGNoZWNrIiwic2NvcGUiLCJzZWxlY3RlZCIsInNoYXBlIiwic2l6ZSIsInNpemVzIiwic3BhbiIsInNyY2xhbmciLCJzdGFydCIsInNyYyIsInNyY3NldCIsInN0ZXAiLCJzdHlsZSIsInN1bW1hcnkiLCJ0YWJpbmRleCIsInRpdGxlIiwidHJhbnNsYXRlIiwidHlwZSIsInVzZW1hcCIsInZhbGlnbiIsInZhbHVlIiwid2lkdGgiLCJ3cmFwIiwieG1sbnMiLCJzbG90Il0pLFU9aShbImFjY2VudC1oZWlnaHQiLCJhY2N1bXVsYXRlIiwiYWRkaXRpdmUiLCJhbGlnbm1lbnQtYmFzZWxpbmUiLCJhc2NlbnQiLCJhdHRyaWJ1dGVuYW1lIiwiYXR0cmlidXRldHlwZSIsImF6aW11dGgiLCJiYXNlZnJlcXVlbmN5IiwiYmFzZWxpbmUtc2hpZnQiLCJiZWdpbiIsImJpYXMiLCJieSIsImNsYXNzIiwiY2xpcCIsImNsaXBwYXRodW5pdHMiLCJjbGlwLXBhdGgiLCJjbGlwLXJ1bGUiLCJjb2xvciIsImNvbG9yLWludGVycG9sYXRpb24iLCJjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMiLCJjb2xvci1wcm9maWxlIiwiY29sb3ItcmVuZGVyaW5nIiwiY3giLCJjeSIsImQiLCJkeCIsImR5IiwiZGlmZnVzZWNvbnN0YW50IiwiZGlyZWN0aW9uIiwiZGlzcGxheSIsImRpdmlzb3IiLCJkdXIiLCJlZGdlbW9kZSIsImVsZXZhdGlvbiIsImVuZCIsImZpbGwiLCJmaWxsLW9wYWNpdHkiLCJmaWxsLXJ1bGUiLCJmaWx0ZXIiLCJmaWx0ZXJ1bml0cyIsImZsb29kLWNvbG9yIiwiZmxvb2Qtb3BhY2l0eSIsImZvbnQtZmFtaWx5IiwiZm9udC1zaXplIiwiZm9udC1zaXplLWFkanVzdCIsImZvbnQtc3RyZXRjaCIsImZvbnQtc3R5bGUiLCJmb250LXZhcmlhbnQiLCJmb250LXdlaWdodCIsImZ4IiwiZnkiLCJnMSIsImcyIiwiZ2x5cGgtbmFtZSIsImdseXBocmVmIiwiZ3JhZGllbnR1bml0cyIsImdyYWRpZW50dHJhbnNmb3JtIiwiaGVpZ2h0IiwiaHJlZiIsImlkIiwiaW1hZ2UtcmVuZGVyaW5nIiwiaW4iLCJpbjIiLCJrIiwiazEiLCJrMiIsImszIiwiazQiLCJrZXJuaW5nIiwia2V5cG9pbnRzIiwia2V5c3BsaW5lcyIsImtleXRpbWVzIiwibGFuZyIsImxlbmd0aGFkanVzdCIsImxldHRlci1zcGFjaW5nIiwia2VybmVsbWF0cml4Iiwia2VybmVsdW5pdGxlbmd0aCIsImxpZ2h0aW5nLWNvbG9yIiwibG9jYWwiLCJtYXJrZXItZW5kIiwibWFya2VyLW1pZCIsIm1hcmtlci1zdGFydCIsIm1hcmtlcmhlaWdodCIsIm1hcmtlcnVuaXRzIiwibWFya2Vyd2lkdGgiLCJtYXNrY29udGVudHVuaXRzIiwibWFza3VuaXRzIiwibWF4IiwibWFzayIsIm1lZGlhIiwibWV0aG9kIiwibW9kZSIsIm1pbiIsIm5hbWUiLCJudW1vY3RhdmVzIiwib2Zmc2V0Iiwib3BlcmF0b3IiLCJvcGFjaXR5Iiwib3JkZXIiLCJvcmllbnQiLCJvcmllbnRhdGlvbiIsIm9yaWdpbiIsIm92ZXJmbG93IiwicGFpbnQtb3JkZXIiLCJwYXRoIiwicGF0aGxlbmd0aCIsInBhdHRlcm5jb250ZW50dW5pdHMiLCJwYXR0ZXJudHJhbnNmb3JtIiwicGF0dGVybnVuaXRzIiwicG9pbnRzIiwicHJlc2VydmVhbHBoYSIsInByZXNlcnZlYXNwZWN0cmF0aW8iLCJwcmltaXRpdmV1bml0cyIsInIiLCJyeCIsInJ5IiwicmFkaXVzIiwicmVmeCIsInJlZnkiLCJyZXBlYXRjb3VudCIsInJlcGVhdGR1ciIsInJlc3RhcnQiLCJyZXN1bHQiLCJyb3RhdGUiLCJzY2FsZSIsInNlZWQiLCJzaGFwZS1yZW5kZXJpbmciLCJzcGVjdWxhcmNvbnN0YW50Iiwic3BlY3VsYXJleHBvbmVudCIsInNwcmVhZG1ldGhvZCIsInN0YXJ0b2Zmc2V0Iiwic3RkZGV2aWF0aW9uIiwic3RpdGNodGlsZXMiLCJzdG9wLWNvbG9yIiwic3RvcC1vcGFjaXR5Iiwic3Ryb2tlLWRhc2hhcnJheSIsInN0cm9rZS1kYXNob2Zmc2V0Iiwic3Ryb2tlLWxpbmVjYXAiLCJzdHJva2UtbGluZWpvaW4iLCJzdHJva2UtbWl0ZXJsaW1pdCIsInN0cm9rZS1vcGFjaXR5Iiwic3Ryb2tlIiwic3Ryb2tlLXdpZHRoIiwic3R5bGUiLCJzdXJmYWNlc2NhbGUiLCJzeXN0ZW1sYW5ndWFnZSIsInRhYmluZGV4IiwidGFyZ2V0eCIsInRhcmdldHkiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2Zvcm0tb3JpZ2luIiwidGV4dC1hbmNob3IiLCJ0ZXh0LWRlY29yYXRpb24iLCJ0ZXh0LXJlbmRlcmluZyIsInRleHRsZW5ndGgiLCJ0eXBlIiwidTEiLCJ1MiIsInVuaWNvZGUiLCJ2YWx1ZXMiLCJ2aWV3Ym94IiwidmlzaWJpbGl0eSIsInZlcnNpb24iLCJ2ZXJ0LWFkdi15IiwidmVydC1vcmlnaW4teCIsInZlcnQtb3JpZ2luLXkiLCJ3aWR0aCIsIndvcmQtc3BhY2luZyIsIndyYXAiLCJ3cml0aW5nLW1vZGUiLCJ4Y2hhbm5lbHNlbGVjdG9yIiwieWNoYW5uZWxzZWxlY3RvciIsIngiLCJ4MSIsIngyIiwieG1sbnMiLCJ5IiwieTEiLCJ5MiIsInoiLCJ6b29tYW5kcGFuIl0pLFA9aShbImFjY2VudCIsImFjY2VudHVuZGVyIiwiYWxpZ24iLCJiZXZlbGxlZCIsImNsb3NlIiwiY29sdW1uc2FsaWduIiwiY29sdW1ubGluZXMiLCJjb2x1bW5zcGFuIiwiZGVub21hbGlnbiIsImRlcHRoIiwiZGlyIiwiZGlzcGxheSIsImRpc3BsYXlzdHlsZSIsImVuY29kaW5nIiwiZmVuY2UiLCJmcmFtZSIsImhlaWdodCIsImhyZWYiLCJpZCIsImxhcmdlb3AiLCJsZW5ndGgiLCJsaW5ldGhpY2tuZXNzIiwibHNwYWNlIiwibHF1b3RlIiwibWF0aGJhY2tncm91bmQiLCJtYXRoY29sb3IiLCJtYXRoc2l6ZSIsIm1hdGh2YXJpYW50IiwibWF4c2l6ZSIsIm1pbnNpemUiLCJtb3ZhYmxlbGltaXRzIiwibm90YXRpb24iLCJudW1hbGlnbiIsIm9wZW4iLCJyb3dhbGlnbiIsInJvd2xpbmVzIiwicm93c3BhY2luZyIsInJvd3NwYW4iLCJyc3BhY2UiLCJycXVvdGUiLCJzY3JpcHRsZXZlbCIsInNjcmlwdG1pbnNpemUiLCJzY3JpcHRzaXplbXVsdGlwbGllciIsInNlbGVjdGlvbiIsInNlcGFyYXRvciIsInNlcGFyYXRvcnMiLCJzdHJldGNoeSIsInN1YnNjcmlwdHNoaWZ0Iiwic3Vwc2NyaXB0c2hpZnQiLCJzeW1tZXRyaWMiLCJ2b2Zmc2V0Iiwid2lkdGgiLCJ4bWxucyJdKSxGPWkoWyJ4bGluazpocmVmIiwieG1sOmlkIiwieGxpbms6dGl0bGUiLCJ4bWw6c3BhY2UiLCJ4bWxuczp4bGluayJdKSxIPWEoL1x7XHtbXHdcV10qfFtcd1xXXSpcfVx9L2dtKSx6PWEoLzwlW1x3XFddKnxbXHdcV10qJT4vZ20pLEI9YSgvXCR7W1x3XFddKn0vZ20pLFc9YSgvXmRhdGEtW1wtXHcuXHUwMEI3LVx1RkZGRl0vKSxHPWEoL15hcmlhLVtcLVx3XSskLyksWT1hKC9eKD86KD86KD86ZnxodCl0cHM/fG1haWx0b3x0ZWx8Y2FsbHRvfHNtc3xjaWR8eG1wcCk6fFteYS16XXxbYS16Ky5cLV0rKD86W15hLXorLlwtOl18JCkpL2kpLGo9YSgvXig/Olx3K3NjcmlwdHxkYXRhKTovaSksWD1hKC9bXHUwMDAwLVx1MDAyMFx1MDBBMFx1MTY4MFx1MTgwRVx1MjAwMC1cdTIwMjlcdTIwNUZcdTMwMDBdL2cpLHE9YSgvXmh0bWwkL2kpLCQ9YSgvXlthLXpdWy5cd10qKC1bLlx3XSspKyQvaSk7dmFyIEs9T2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsTVVTVEFDSEVfRVhQUjpILEVSQl9FWFBSOnosVE1QTElUX0VYUFI6QixEQVRBX0FUVFI6VyxBUklBX0FUVFI6RyxJU19BTExPV0VEX1VSSTpZLElTX1NDUklQVF9PUl9EQVRBOmosQVRUUl9XSElURVNQQUNFOlgsRE9DVFlQRV9OQU1FOnEsQ1VTVE9NX0VMRU1FTlQ6JH0pO2NvbnN0IFY9MSxaPTMsSj03LFE9OCxlZT05LHRlPWZ1bmN0aW9uKCl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/bnVsbDp3aW5kb3d9O3ZhciBuZT1mdW5jdGlvbiB0KCl7bGV0IG49YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnRlKCk7Y29uc3Qgbz1lPT50KGUpO2lmKG8udmVyc2lvbj0iMy4xLjYiLG8ucmVtb3ZlZD1bXSwhbnx8IW4uZG9jdW1lbnR8fG4uZG9jdW1lbnQubm9kZVR5cGUhPT1lZSlyZXR1cm4gby5pc1N1cHBvcnRlZD0hMSxvO2xldHtkb2N1bWVudDpyfT1uO2NvbnN0IGE9cixjPWEuY3VycmVudFNjcmlwdCx7RG9jdW1lbnRGcmFnbWVudDpzLEhUTUxUZW1wbGF0ZUVsZW1lbnQ6TixOb2RlOmIsRWxlbWVudDpSLE5vZGVGaWx0ZXI6SCxOYW1lZE5vZGVNYXA6ej1uLk5hbWVkTm9kZU1hcHx8bi5Nb3pOYW1lZEF0dHJNYXAsSFRNTEZvcm1FbGVtZW50OkIsRE9NUGFyc2VyOlcsdHJ1c3RlZFR5cGVzOkd9PW4saj1SLnByb3RvdHlwZSxYPUMoaiwiY2xvbmVOb2RlIiksJD1DKGosInJlbW92ZSIpLG5lPUMoaiwibmV4dFNpYmxpbmciKSxvZT1DKGosImNoaWxkTm9kZXMiKSxyZT1DKGosInBhcmVudE5vZGUiKTtpZigiZnVuY3Rpb24iPT10eXBlb2YgTil7Y29uc3QgZT1yLmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7ZS5jb250ZW50JiZlLmNvbnRlbnQub3duZXJEb2N1bWVudCYmKHI9ZS5jb250ZW50Lm93bmVyRG9jdW1lbnQpfWxldCBpZSxhZT0iIjtjb25zdHtpbXBsZW1lbnRhdGlvbjpsZSxjcmVhdGVOb2RlSXRlcmF0b3I6Y2UsY3JlYXRlRG9jdW1lbnRGcmFnbWVudDpzZSxnZXRFbGVtZW50c0J5VGFnTmFtZTp1ZX09cix7aW1wb3J0Tm9kZTptZX09YTtsZXQgcGU9e307by5pc1N1cHBvcnRlZD0iZnVuY3Rpb24iPT10eXBlb2YgZSYmImZ1bmN0aW9uIj09dHlwZW9mIHJlJiZsZSYmdm9pZCAwIT09bGUuY3JlYXRlSFRNTERvY3VtZW50O2NvbnN0e01VU1RBQ0hFX0VYUFI6ZmUsRVJCX0VYUFI6ZGUsVE1QTElUX0VYUFI6aGUsREFUQV9BVFRSOmdlLEFSSUFfQVRUUjpUZSxJU19TQ1JJUFRfT1JfREFUQTp5ZSxBVFRSX1dISVRFU1BBQ0U6RWUsQ1VTVE9NX0VMRU1FTlQ6X2V9PUs7bGV0e0lTX0FMTE9XRURfVVJJOkFlfT1LLE5lPW51bGw7Y29uc3QgYmU9Uyh7fSxbLi4uTCwuLi5ELC4uLnYsLi4ueCwuLi5NXSk7bGV0IFNlPW51bGw7Y29uc3QgUmU9Uyh7fSxbLi4uSSwuLi5VLC4uLlAsLi4uRl0pO2xldCB3ZT1PYmplY3Quc2VhbChsKG51bGwse3RhZ05hbWVDaGVjazp7d3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiExLGVudW1lcmFibGU6ITAsdmFsdWU6bnVsbH0sYXR0cmlidXRlTmFtZUNoZWNrOnt3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITEsZW51bWVyYWJsZTohMCx2YWx1ZTpudWxsfSxhbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHM6e3dyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMSxlbnVtZXJhYmxlOiEwLHZhbHVlOiExfX0pKSxDZT1udWxsLExlPW51bGwsRGU9ITAsdmU9ITAsT2U9ITEseGU9ITAsa2U9ITEsTWU9ITAsSWU9ITEsVWU9ITEsUGU9ITEsRmU9ITEsSGU9ITEsemU9ITEsQmU9ITAsV2U9ITEsR2U9ITAsWWU9ITEsamU9e30sWGU9bnVsbDtjb25zdCBxZT1TKHt9LFsiYW5ub3RhdGlvbi14bWwiLCJhdWRpbyIsImNvbGdyb3VwIiwiZGVzYyIsImZvcmVpZ25vYmplY3QiLCJoZWFkIiwiaWZyYW1lIiwibWF0aCIsIm1pIiwibW4iLCJtbyIsIm1zIiwibXRleHQiLCJub2VtYmVkIiwibm9mcmFtZXMiLCJub3NjcmlwdCIsInBsYWludGV4dCIsInNjcmlwdCIsInN0eWxlIiwic3ZnIiwidGVtcGxhdGUiLCJ0aGVhZCIsInRpdGxlIiwidmlkZW8iLCJ4bXAiXSk7bGV0ICRlPW51bGw7Y29uc3QgS2U9Uyh7fSxbImF1ZGlvIiwidmlkZW8iLCJpbWciLCJzb3VyY2UiLCJpbWFnZSIsInRyYWNrIl0pO2xldCBWZT1udWxsO2NvbnN0IFplPVMoe30sWyJhbHQiLCJjbGFzcyIsImZvciIsImlkIiwibGFiZWwiLCJuYW1lIiwicGF0dGVybiIsInBsYWNlaG9sZGVyIiwicm9sZSIsInN1bW1hcnkiLCJ0aXRsZSIsInZhbHVlIiwic3R5bGUiLCJ4bWxucyJdKSxKZT0iaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCIsUWU9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixldD0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7bGV0IHR0PWV0LG50PSExLG90PW51bGw7Y29uc3QgcnQ9Uyh7fSxbSmUsUWUsZXRdLGQpO2xldCBpdD1udWxsO2NvbnN0IGF0PVsiYXBwbGljYXRpb24veGh0bWwreG1sIiwidGV4dC9odG1sIl07bGV0IGx0PW51bGwsY3Q9bnVsbDtjb25zdCBzdD1yLmNyZWF0ZUVsZW1lbnQoImZvcm0iKSx1dD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIFJlZ0V4cHx8ZSBpbnN0YW5jZW9mIEZ1bmN0aW9ufSxtdD1mdW5jdGlvbigpe2xldCBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fTtpZighY3R8fGN0IT09ZSl7aWYoZSYmIm9iamVjdCI9PXR5cGVvZiBlfHwoZT17fSksZT13KGUpLGl0PS0xPT09YXQuaW5kZXhPZihlLlBBUlNFUl9NRURJQV9UWVBFKT8idGV4dC9odG1sIjplLlBBUlNFUl9NRURJQV9UWVBFLGx0PSJhcHBsaWNhdGlvbi94aHRtbCt4bWwiPT09aXQ/ZDpmLE5lPUUoZSwiQUxMT1dFRF9UQUdTIik/Uyh7fSxlLkFMTE9XRURfVEFHUyxsdCk6YmUsU2U9RShlLCJBTExPV0VEX0FUVFIiKT9TKHt9LGUuQUxMT1dFRF9BVFRSLGx0KTpSZSxvdD1FKGUsIkFMTE9XRURfTkFNRVNQQUNFUyIpP1Moe30sZS5BTExPV0VEX05BTUVTUEFDRVMsZCk6cnQsVmU9RShlLCJBRERfVVJJX1NBRkVfQVRUUiIpP1ModyhaZSksZS5BRERfVVJJX1NBRkVfQVRUUixsdCk6WmUsJGU9RShlLCJBRERfREFUQV9VUklfVEFHUyIpP1ModyhLZSksZS5BRERfREFUQV9VUklfVEFHUyxsdCk6S2UsWGU9RShlLCJGT1JCSURfQ09OVEVOVFMiKT9TKHt9LGUuRk9SQklEX0NPTlRFTlRTLGx0KTpxZSxDZT1FKGUsIkZPUkJJRF9UQUdTIik/Uyh7fSxlLkZPUkJJRF9UQUdTLGx0KTp7fSxMZT1FKGUsIkZPUkJJRF9BVFRSIik/Uyh7fSxlLkZPUkJJRF9BVFRSLGx0KTp7fSxqZT0hIUUoZSwiVVNFX1BST0ZJTEVTIikmJmUuVVNFX1BST0ZJTEVTLERlPSExIT09ZS5BTExPV19BUklBX0FUVFIsdmU9ITEhPT1lLkFMTE9XX0RBVEFfQVRUUixPZT1lLkFMTE9XX1VOS05PV05fUFJPVE9DT0xTfHwhMSx4ZT0hMSE9PWUuQUxMT1dfU0VMRl9DTE9TRV9JTl9BVFRSLGtlPWUuU0FGRV9GT1JfVEVNUExBVEVTfHwhMSxNZT0hMSE9PWUuU0FGRV9GT1JfWE1MLEllPWUuV0hPTEVfRE9DVU1FTlR8fCExLEZlPWUuUkVUVVJOX0RPTXx8ITEsSGU9ZS5SRVRVUk5fRE9NX0ZSQUdNRU5UfHwhMSx6ZT1lLlJFVFVSTl9UUlVTVEVEX1RZUEV8fCExLFBlPWUuRk9SQ0VfQk9EWXx8ITEsQmU9ITEhPT1lLlNBTklUSVpFX0RPTSxXZT1lLlNBTklUSVpFX05BTUVEX1BST1BTfHwhMSxHZT0hMSE9PWUuS0VFUF9DT05URU5ULFllPWUuSU5fUExBQ0V8fCExLEFlPWUuQUxMT1dFRF9VUklfUkVHRVhQfHxZLHR0PWUuTkFNRVNQQUNFfHxldCx3ZT1lLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HfHx7fSxlLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HJiZ1dChlLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjaykmJih3ZS50YWdOYW1lQ2hlY2s9ZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2spLGUuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcmJnV0KGUuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcuYXR0cmlidXRlTmFtZUNoZWNrKSYmKHdlLmF0dHJpYnV0ZU5hbWVDaGVjaz1lLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjayksZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORyYmImJvb2xlYW4iPT10eXBlb2YgZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMmJih3ZS5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHM9ZS5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMpLGtlJiYodmU9ITEpLEhlJiYoRmU9ITApLGplJiYoTmU9Uyh7fSxNKSxTZT1bXSwhMD09PWplLmh0bWwmJihTKE5lLEwpLFMoU2UsSSkpLCEwPT09amUuc3ZnJiYoUyhOZSxEKSxTKFNlLFUpLFMoU2UsRikpLCEwPT09amUuc3ZnRmlsdGVycyYmKFMoTmUsdiksUyhTZSxVKSxTKFNlLEYpKSwhMD09PWplLm1hdGhNbCYmKFMoTmUseCksUyhTZSxQKSxTKFNlLEYpKSksZS5BRERfVEFHUyYmKE5lPT09YmUmJihOZT13KE5lKSksUyhOZSxlLkFERF9UQUdTLGx0KSksZS5BRERfQVRUUiYmKFNlPT09UmUmJihTZT13KFNlKSksUyhTZSxlLkFERF9BVFRSLGx0KSksZS5BRERfVVJJX1NBRkVfQVRUUiYmUyhWZSxlLkFERF9VUklfU0FGRV9BVFRSLGx0KSxlLkZPUkJJRF9DT05URU5UUyYmKFhlPT09cWUmJihYZT13KFhlKSksUyhYZSxlLkZPUkJJRF9DT05URU5UUyxsdCkpLEdlJiYoTmVbIiN0ZXh0Il09ITApLEllJiZTKE5lLFsiaHRtbCIsImhlYWQiLCJib2R5Il0pLE5lLnRhYmxlJiYoUyhOZSxbInRib2R5Il0pLGRlbGV0ZSBDZS50Ym9keSksZS5UUlVTVEVEX1RZUEVTX1BPTElDWSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUuVFJVU1RFRF9UWVBFU19QT0xJQ1kuY3JlYXRlSFRNTCl0aHJvdyBBKCdUUlVTVEVEX1RZUEVTX1BPTElDWSBjb25maWd1cmF0aW9uIG9wdGlvbiBtdXN0IHByb3ZpZGUgYSAiY3JlYXRlSFRNTCIgaG9vay4nKTtpZigiZnVuY3Rpb24iIT10eXBlb2YgZS5UUlVTVEVEX1RZUEVTX1BPTElDWS5jcmVhdGVTY3JpcHRVUkwpdGhyb3cgQSgnVFJVU1RFRF9UWVBFU19QT0xJQ1kgY29uZmlndXJhdGlvbiBvcHRpb24gbXVzdCBwcm92aWRlIGEgImNyZWF0ZVNjcmlwdFVSTCIgaG9vay4nKTtpZT1lLlRSVVNURURfVFlQRVNfUE9MSUNZLGFlPWllLmNyZWF0ZUhUTUwoIiIpfWVsc2Ugdm9pZCAwPT09aWUmJihpZT1mdW5jdGlvbihlLHQpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUuY3JlYXRlUG9saWN5KXJldHVybiBudWxsO2xldCBuPW51bGw7Y29uc3Qgbz0iZGF0YS10dC1wb2xpY3ktc3VmZml4Ijt0JiZ0Lmhhc0F0dHJpYnV0ZShvKSYmKG49dC5nZXRBdHRyaWJ1dGUobykpO2NvbnN0IHI9ImRvbXB1cmlmeSIrKG4/IiMiK246IiIpO3RyeXtyZXR1cm4gZS5jcmVhdGVQb2xpY3kocix7Y3JlYXRlSFRNTDplPT5lLGNyZWF0ZVNjcmlwdFVSTDplPT5lfSl9Y2F0Y2goZSl7cmV0dXJuIGNvbnNvbGUud2FybigiVHJ1c3RlZFR5cGVzIHBvbGljeSAiK3IrIiBjb3VsZCBub3QgYmUgY3JlYXRlZC4iKSxudWxsfX0oRyxjKSksbnVsbCE9PWllJiYic3RyaW5nIj09dHlwZW9mIGFlJiYoYWU9aWUuY3JlYXRlSFRNTCgiIikpO2kmJmkoZSksY3Q9ZX19LHB0PVMoe30sWyJtaSIsIm1vIiwibW4iLCJtcyIsIm10ZXh0Il0pLGZ0PVMoe30sWyJmb3JlaWdub2JqZWN0IiwiYW5ub3RhdGlvbi14bWwiXSksZHQ9Uyh7fSxbInRpdGxlIiwic3R5bGUiLCJmb250IiwiYSIsInNjcmlwdCJdKSxodD1TKHt9LFsuLi5ELC4uLnYsLi4uT10pLGd0PVMoe30sWy4uLngsLi4ua10pLFR0PWZ1bmN0aW9uKGUpe3Aoby5yZW1vdmVkLHtlbGVtZW50OmV9KTt0cnl7cmUoZSkucmVtb3ZlQ2hpbGQoZSl9Y2F0Y2godCl7JChlKX19LHl0PWZ1bmN0aW9uKGUsdCl7dHJ5e3Aoby5yZW1vdmVkLHthdHRyaWJ1dGU6dC5nZXRBdHRyaWJ1dGVOb2RlKGUpLGZyb206dH0pfWNhdGNoKGUpe3Aoby5yZW1vdmVkLHthdHRyaWJ1dGU6bnVsbCxmcm9tOnR9KX1pZih0LnJlbW92ZUF0dHJpYnV0ZShlKSwiaXMiPT09ZSYmIVNlW2VdKWlmKEZlfHxIZSl0cnl7VHQodCl9Y2F0Y2goZSl7fWVsc2UgdHJ5e3Quc2V0QXR0cmlidXRlKGUsIiIpfWNhdGNoKGUpe319LEV0PWZ1bmN0aW9uKGUpe2xldCB0PW51bGwsbj1udWxsO2lmKFBlKWU9IjxyZW1vdmU+PC9yZW1vdmU+IitlO2Vsc2V7Y29uc3QgdD1oKGUsL15bXHJcblx0IF0rLyk7bj10JiZ0WzBdfSJhcHBsaWNhdGlvbi94aHRtbCt4bWwiPT09aXQmJnR0PT09ZXQmJihlPSc8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+PGhlYWQ+PC9oZWFkPjxib2R5PicrZSsiPC9ib2R5PjwvaHRtbD4iKTtjb25zdCBvPWllP2llLmNyZWF0ZUhUTUwoZSk6ZTtpZih0dD09PWV0KXRyeXt0PShuZXcgVykucGFyc2VGcm9tU3RyaW5nKG8saXQpfWNhdGNoKGUpe31pZighdHx8IXQuZG9jdW1lbnRFbGVtZW50KXt0PWxlLmNyZWF0ZURvY3VtZW50KHR0LCJ0ZW1wbGF0ZSIsbnVsbCk7dHJ5e3QuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTD1udD9hZTpvfWNhdGNoKGUpe319Y29uc3QgaT10LmJvZHl8fHQuZG9jdW1lbnRFbGVtZW50O3JldHVybiBlJiZuJiZpLmluc2VydEJlZm9yZShyLmNyZWF0ZVRleHROb2RlKG4pLGkuY2hpbGROb2Rlc1swXXx8bnVsbCksdHQ9PT1ldD91ZS5jYWxsKHQsSWU/Imh0bWwiOiJib2R5IilbMF06SWU/dC5kb2N1bWVudEVsZW1lbnQ6aX0sX3Q9ZnVuY3Rpb24oZSl7cmV0dXJuIGNlLmNhbGwoZS5vd25lckRvY3VtZW50fHxlLGUsSC5TSE9XX0VMRU1FTlR8SC5TSE9XX0NPTU1FTlR8SC5TSE9XX1RFWFR8SC5TSE9XX1BST0NFU1NJTkdfSU5TVFJVQ1RJT058SC5TSE9XX0NEQVRBX1NFQ1RJT04sbnVsbCl9LEF0PWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgQiYmKCJzdHJpbmciIT10eXBlb2YgZS5ub2RlTmFtZXx8InN0cmluZyIhPXR5cGVvZiBlLnRleHRDb250ZW50fHwiZnVuY3Rpb24iIT10eXBlb2YgZS5yZW1vdmVDaGlsZHx8IShlLmF0dHJpYnV0ZXMgaW5zdGFuY2VvZiB6KXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUucmVtb3ZlQXR0cmlidXRlfHwiZnVuY3Rpb24iIT10eXBlb2YgZS5zZXRBdHRyaWJ1dGV8fCJzdHJpbmciIT10eXBlb2YgZS5uYW1lc3BhY2VVUkl8fCJmdW5jdGlvbiIhPXR5cGVvZiBlLmluc2VydEJlZm9yZXx8ImZ1bmN0aW9uIiE9dHlwZW9mIGUuaGFzQ2hpbGROb2Rlcyl9LE50PWZ1bmN0aW9uKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBiJiZlIGluc3RhbmNlb2YgYn0sYnQ9ZnVuY3Rpb24oZSx0LG4pe3BlW2VdJiZ1KHBlW2VdLChlPT57ZS5jYWxsKG8sdCxuLGN0KX0pKX0sU3Q9ZnVuY3Rpb24oZSl7bGV0IHQ9bnVsbDtpZihidCgiYmVmb3JlU2FuaXRpemVFbGVtZW50cyIsZSxudWxsKSxBdChlKSlyZXR1cm4gVHQoZSksITA7Y29uc3Qgbj1sdChlLm5vZGVOYW1lKTtpZihidCgidXBvblNhbml0aXplRWxlbWVudCIsZSx7dGFnTmFtZTpuLGFsbG93ZWRUYWdzOk5lfSksZS5oYXNDaGlsZE5vZGVzKCkmJiFOdChlLmZpcnN0RWxlbWVudENoaWxkKSYmXygvPFsvXHddL2csZS5pbm5lckhUTUwpJiZfKC88Wy9cd10vZyxlLnRleHRDb250ZW50KSlyZXR1cm4gVHQoZSksITA7aWYoZS5ub2RlVHlwZT09PUopcmV0dXJuIFR0KGUpLCEwO2lmKE1lJiZlLm5vZGVUeXBlPT09USYmXygvPFsvXHddL2csZS5kYXRhKSlyZXR1cm4gVHQoZSksITA7aWYoIU5lW25dfHxDZVtuXSl7aWYoIUNlW25dJiZ3dChuKSl7aWYod2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgUmVnRXhwJiZfKHdlLnRhZ05hbWVDaGVjayxuKSlyZXR1cm4hMTtpZih3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBGdW5jdGlvbiYmd2UudGFnTmFtZUNoZWNrKG4pKXJldHVybiExfWlmKEdlJiYhWGVbbl0pe2NvbnN0IHQ9cmUoZSl8fGUucGFyZW50Tm9kZSxuPW9lKGUpfHxlLmNoaWxkTm9kZXM7aWYobiYmdCl7Zm9yKGxldCBvPW4ubGVuZ3RoLTE7bz49MDstLW8pe2NvbnN0IHI9WChuW29dLCEwKTtyLl9fcmVtb3ZhbENvdW50PShlLl9fcmVtb3ZhbENvdW50fHwwKSsxLHQuaW5zZXJ0QmVmb3JlKHIsbmUoZSkpfX19cmV0dXJuIFR0KGUpLCEwfXJldHVybiBlIGluc3RhbmNlb2YgUiYmIWZ1bmN0aW9uKGUpe2xldCB0PXJlKGUpO3QmJnQudGFnTmFtZXx8KHQ9e25hbWVzcGFjZVVSSTp0dCx0YWdOYW1lOiJ0ZW1wbGF0ZSJ9KTtjb25zdCBuPWYoZS50YWdOYW1lKSxvPWYodC50YWdOYW1lKTtyZXR1cm4hIW90W2UubmFtZXNwYWNlVVJJXSYmKGUubmFtZXNwYWNlVVJJPT09UWU/dC5uYW1lc3BhY2VVUkk9PT1ldD8ic3ZnIj09PW46dC5uYW1lc3BhY2VVUkk9PT1KZT8ic3ZnIj09PW4mJigiYW5ub3RhdGlvbi14bWwiPT09b3x8cHRbb10pOkJvb2xlYW4oaHRbbl0pOmUubmFtZXNwYWNlVVJJPT09SmU/dC5uYW1lc3BhY2VVUkk9PT1ldD8ibWF0aCI9PT1uOnQubmFtZXNwYWNlVVJJPT09UWU/Im1hdGgiPT09biYmZnRbb106Qm9vbGVhbihndFtuXSk6ZS5uYW1lc3BhY2VVUkk9PT1ldD8hKHQubmFtZXNwYWNlVVJJPT09UWUmJiFmdFtvXSkmJiEodC5uYW1lc3BhY2VVUkk9PT1KZSYmIXB0W29dKSYmIWd0W25dJiYoZHRbbl18fCFodFtuXSk6ISgiYXBwbGljYXRpb24veGh0bWwreG1sIiE9PWl0fHwhb3RbZS5uYW1lc3BhY2VVUkldKSl9KGUpPyhUdChlKSwhMCk6Im5vc2NyaXB0IiE9PW4mJiJub2VtYmVkIiE9PW4mJiJub2ZyYW1lcyIhPT1ufHwhXygvPFwvbm8oc2NyaXB0fGVtYmVkfGZyYW1lcykvaSxlLmlubmVySFRNTCk/KGtlJiZlLm5vZGVUeXBlPT09WiYmKHQ9ZS50ZXh0Q29udGVudCx1KFtmZSxkZSxoZV0sKGU9Pnt0PWcodCxlLCIgIil9KSksZS50ZXh0Q29udGVudCE9PXQmJihwKG8ucmVtb3ZlZCx7ZWxlbWVudDplLmNsb25lTm9kZSgpfSksZS50ZXh0Q29udGVudD10KSksYnQoImFmdGVyU2FuaXRpemVFbGVtZW50cyIsZSxudWxsKSwhMSk6KFR0KGUpLCEwKX0sUnQ9ZnVuY3Rpb24oZSx0LG4pe2lmKEJlJiYoImlkIj09PXR8fCJuYW1lIj09PXQpJiYobiBpbiByfHxuIGluIHN0KSlyZXR1cm4hMTtpZih2ZSYmIUxlW3RdJiZfKGdlLHQpKTtlbHNlIGlmKERlJiZfKFRlLHQpKTtlbHNlIGlmKCFTZVt0XXx8TGVbdF0pe2lmKCEod3QoZSkmJih3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBSZWdFeHAmJl8od2UudGFnTmFtZUNoZWNrLGUpfHx3ZS50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBGdW5jdGlvbiYmd2UudGFnTmFtZUNoZWNrKGUpKSYmKHdlLmF0dHJpYnV0ZU5hbWVDaGVjayBpbnN0YW5jZW9mIFJlZ0V4cCYmXyh3ZS5hdHRyaWJ1dGVOYW1lQ2hlY2ssdCl8fHdlLmF0dHJpYnV0ZU5hbWVDaGVjayBpbnN0YW5jZW9mIEZ1bmN0aW9uJiZ3ZS5hdHRyaWJ1dGVOYW1lQ2hlY2sodCkpfHwiaXMiPT09dCYmd2UuYWxsb3dDdXN0b21pemVkQnVpbHRJbkVsZW1lbnRzJiYod2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgUmVnRXhwJiZfKHdlLnRhZ05hbWVDaGVjayxuKXx8d2UudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgRnVuY3Rpb24mJndlLnRhZ05hbWVDaGVjayhuKSkpKXJldHVybiExfWVsc2UgaWYoVmVbdF0pO2Vsc2UgaWYoXyhBZSxnKG4sRWUsIiIpKSk7ZWxzZSBpZigic3JjIiE9PXQmJiJ4bGluazpocmVmIiE9PXQmJiJocmVmIiE9PXR8fCJzY3JpcHQiPT09ZXx8MCE9PVQobiwiZGF0YToiKXx8ISRlW2VdKXtpZihPZSYmIV8oeWUsZyhuLEVlLCIiKSkpO2Vsc2UgaWYobilyZXR1cm4hMX1lbHNlO3JldHVybiEwfSx3dD1mdW5jdGlvbihlKXtyZXR1cm4iYW5ub3RhdGlvbi14bWwiIT09ZSYmaChlLF9lKX0sQ3Q9ZnVuY3Rpb24oZSl7YnQoImJlZm9yZVNhbml0aXplQXR0cmlidXRlcyIsZSxudWxsKTtjb25zdHthdHRyaWJ1dGVzOnR9PWU7aWYoIXQpcmV0dXJuO2NvbnN0IG49e2F0dHJOYW1lOiIiLGF0dHJWYWx1ZToiIixrZWVwQXR0cjohMCxhbGxvd2VkQXR0cmlidXRlczpTZX07bGV0IHI9dC5sZW5ndGg7Zm9yKDtyLS07KXtjb25zdCBpPXRbcl0se25hbWU6YSxuYW1lc3BhY2VVUkk6bCx2YWx1ZTpjfT1pLHM9bHQoYSk7bGV0IHA9InZhbHVlIj09PWE/Yzp5KGMpO2lmKG4uYXR0ck5hbWU9cyxuLmF0dHJWYWx1ZT1wLG4ua2VlcEF0dHI9ITAsbi5mb3JjZUtlZXBBdHRyPXZvaWQgMCxidCgidXBvblNhbml0aXplQXR0cmlidXRlIixlLG4pLHA9bi5hdHRyVmFsdWUsTWUmJl8oLygoLS0hP3xdKT4pfDxcLyhzdHlsZXx0aXRsZSkvaSxwKSl7eXQoYSxlKTtjb250aW51ZX1pZihuLmZvcmNlS2VlcEF0dHIpY29udGludWU7aWYoeXQoYSxlKSwhbi5rZWVwQXR0ciljb250aW51ZTtpZigheGUmJl8oL1wvPi9pLHApKXt5dChhLGUpO2NvbnRpbnVlfWtlJiZ1KFtmZSxkZSxoZV0sKGU9PntwPWcocCxlLCIgIil9KSk7Y29uc3QgZj1sdChlLm5vZGVOYW1lKTtpZihSdChmLHMscCkpe2lmKCFXZXx8ImlkIiE9PXMmJiJuYW1lIiE9PXN8fCh5dChhLGUpLHA9InVzZXItY29udGVudC0iK3ApLGllJiYib2JqZWN0Ij09dHlwZW9mIEcmJiJmdW5jdGlvbiI9PXR5cGVvZiBHLmdldEF0dHJpYnV0ZVR5cGUpaWYobCk7ZWxzZSBzd2l0Y2goRy5nZXRBdHRyaWJ1dGVUeXBlKGYscykpe2Nhc2UiVHJ1c3RlZEhUTUwiOnA9aWUuY3JlYXRlSFRNTChwKTticmVhaztjYXNlIlRydXN0ZWRTY3JpcHRVUkwiOnA9aWUuY3JlYXRlU2NyaXB0VVJMKHApfXRyeXtsP2Uuc2V0QXR0cmlidXRlTlMobCxhLHApOmUuc2V0QXR0cmlidXRlKGEscCksQXQoZSk/VHQoZSk6bShvLnJlbW92ZWQpfWNhdGNoKGUpe319fWJ0KCJhZnRlclNhbml0aXplQXR0cmlidXRlcyIsZSxudWxsKX0sTHQ9ZnVuY3Rpb24gZSh0KXtsZXQgbj1udWxsO2NvbnN0IG89X3QodCk7Zm9yKGJ0KCJiZWZvcmVTYW5pdGl6ZVNoYWRvd0RPTSIsdCxudWxsKTtuPW8ubmV4dE5vZGUoKTspYnQoInVwb25TYW5pdGl6ZVNoYWRvd05vZGUiLG4sbnVsbCksU3Qobil8fChuLmNvbnRlbnQgaW5zdGFuY2VvZiBzJiZlKG4uY29udGVudCksQ3QobikpO2J0KCJhZnRlclNhbml0aXplU2hhZG93RE9NIix0LG51bGwpfTtyZXR1cm4gby5zYW5pdGl6ZT1mdW5jdGlvbihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e30sbj1udWxsLHI9bnVsbCxpPW51bGwsbD1udWxsO2lmKG50PSFlLG50JiYoZT0iXHgzYyEtLVx4M2UiKSwic3RyaW5nIiE9dHlwZW9mIGUmJiFOdChlKSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUudG9TdHJpbmcpdGhyb3cgQSgidG9TdHJpbmcgaXMgbm90IGEgZnVuY3Rpb24iKTtpZigic3RyaW5nIiE9dHlwZW9mKGU9ZS50b1N0cmluZygpKSl0aHJvdyBBKCJkaXJ0eSBpcyBub3QgYSBzdHJpbmcsIGFib3J0aW5nIil9aWYoIW8uaXNTdXBwb3J0ZWQpcmV0dXJuIGU7aWYoVWV8fG10KHQpLG8ucmVtb3ZlZD1bXSwic3RyaW5nIj09dHlwZW9mIGUmJihZZT0hMSksWWUpe2lmKGUubm9kZU5hbWUpe2NvbnN0IHQ9bHQoZS5ub2RlTmFtZSk7aWYoIU5lW3RdfHxDZVt0XSl0aHJvdyBBKCJyb290IG5vZGUgaXMgZm9yYmlkZGVuIGFuZCBjYW5ub3QgYmUgc2FuaXRpemVkIGluLXBsYWNlIil9fWVsc2UgaWYoZSBpbnN0YW5jZW9mIGIpbj1FdCgiXHgzYyEtLS0tXHgzZSIpLHI9bi5vd25lckRvY3VtZW50LmltcG9ydE5vZGUoZSwhMCksci5ub2RlVHlwZT09PVYmJiJCT0RZIj09PXIubm9kZU5hbWV8fCJIVE1MIj09PXIubm9kZU5hbWU/bj1yOm4uYXBwZW5kQ2hpbGQocik7ZWxzZXtpZighRmUmJiFrZSYmIUllJiYtMT09PWUuaW5kZXhPZigiPCIpKXJldHVybiBpZSYmemU/aWUuY3JlYXRlSFRNTChlKTplO2lmKG49RXQoZSksIW4pcmV0dXJuIEZlP251bGw6emU/YWU6IiJ9biYmUGUmJlR0KG4uZmlyc3RDaGlsZCk7Y29uc3QgYz1fdChZZT9lOm4pO2Zvcig7aT1jLm5leHROb2RlKCk7KVN0KGkpfHwoaS5jb250ZW50IGluc3RhbmNlb2YgcyYmTHQoaS5jb250ZW50KSxDdChpKSk7aWYoWWUpcmV0dXJuIGU7aWYoRmUpe2lmKEhlKWZvcihsPXNlLmNhbGwobi5vd25lckRvY3VtZW50KTtuLmZpcnN0Q2hpbGQ7KWwuYXBwZW5kQ2hpbGQobi5maXJzdENoaWxkKTtlbHNlIGw9bjtyZXR1cm4oU2Uuc2hhZG93cm9vdHx8U2Uuc2hhZG93cm9vdG1vZGUpJiYobD1tZS5jYWxsKGEsbCwhMCkpLGx9bGV0IG09SWU/bi5vdXRlckhUTUw6bi5pbm5lckhUTUw7cmV0dXJuIEllJiZOZVsiIWRvY3R5cGUiXSYmbi5vd25lckRvY3VtZW50JiZuLm93bmVyRG9jdW1lbnQuZG9jdHlwZSYmbi5vd25lckRvY3VtZW50LmRvY3R5cGUubmFtZSYmXyhxLG4ub3duZXJEb2N1bWVudC5kb2N0eXBlLm5hbWUpJiYobT0iPCFET0NUWVBFICIrbi5vd25lckRvY3VtZW50LmRvY3R5cGUubmFtZSsiPlxuIittKSxrZSYmdShbZmUsZGUsaGVdLChlPT57bT1nKG0sZSwiICIpfSkpLGllJiZ6ZT9pZS5jcmVhdGVIVE1MKG0pOm19LG8uc2V0Q29uZmlnPWZ1bmN0aW9uKCl7bXQoYXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnt9KSxVZT0hMH0sby5jbGVhckNvbmZpZz1mdW5jdGlvbigpe2N0PW51bGwsVWU9ITF9LG8uaXNWYWxpZEF0dHJpYnV0ZT1mdW5jdGlvbihlLHQsbil7Y3R8fG10KHt9KTtjb25zdCBvPWx0KGUpLHI9bHQodCk7cmV0dXJuIFJ0KG8scixuKX0sby5hZGRIb29rPWZ1bmN0aW9uKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIHQmJihwZVtlXT1wZVtlXXx8W10scChwZVtlXSx0KSl9LG8ucmVtb3ZlSG9vaz1mdW5jdGlvbihlKXtpZihwZVtlXSlyZXR1cm4gbShwZVtlXSl9LG8ucmVtb3ZlSG9va3M9ZnVuY3Rpb24oZSl7cGVbZV0mJihwZVtlXT1bXSl9LG8ucmVtb3ZlQWxsSG9va3M9ZnVuY3Rpb24oKXtwZT17fX0sb30oKTtyZXR1cm4gbmV9KSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXB1cmlmeS5taW4uanMubWFwCg==";
            dp.defer = true;
            head.appendChild(dp);
          }

          const studentScript = doc.createElement("script");
          studentScript.defer = true;
          studentScript.textContent = `
                  (function(){
                    const studentState = {
                      questions: ${JSON.stringify(cleanQuestions)},
                      currentQuestion: 0,
                      score: 0,
                      timeLeft: ${qTime},
                      questionTime: ${qTime},
                      timerId: null,
                      isPaused: false,
                      answeredQuestions: [],
                      lastWrong: [],
                      numeralType: ${JSON.stringify(numeral)},
                      shuffledMaps: []
                    };

                    const EASTERN = ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩'];
                    const fmtAr = new Intl.NumberFormat('ar-EG');
                    const fmtLa = new Intl.NumberFormat('en-US');
                    function formatNumber(n){ return studentState.numeralType==='eastern' ? fmtAr.format(n) : fmtLa.format(n); }

                    function convertNumeralsInText(text){
                      if(!text || typeof text!=='string') return text;
                      return studentState.numeralType==='eastern'
                        ? text.replace(/\\d/g, d => EASTERN[d])
                        : text.replace(/[٠-٩]/g, d => EASTERN.indexOf(d));
                    }

                    function applyNumeralTypeToPage(){
                      const SKIP = new Set(['SCRIPT','STYLE','TEXTAREA','INPUT']);
                      function walk(node){
                        if (node.nodeType === Node.TEXT_NODE){
                          node.nodeValue = convertNumeralsInText(node.nodeValue);
                        } else if (node.nodeType === Node.ELEMENT_NODE && !SKIP.has(node.tagName)){
                          for (let i=0;i<node.childNodes.length;i++) walk(node.childNodes[i]);
                        }
                      }
                      const targets = [document.body, document.getElementById('quizTitle'), document.getElementById('instructions'), document.getElementById('quizFooter'), document.getElementById('scoreBoard')];
                      targets.forEach(el => { if (el) walk(el); });
                    }

                    function sanitizeHTML(html){
                      if (!window.DOMPurify) return html || '';
                      return DOMPurify.sanitize(html || '', {
                        ADD_TAGS: ['a','u','mark','blockquote','hr','pre','code','h1','h2','h3','h4','h5','h6','ul','ol','li','img','table','thead','tbody','tr','td','th','p','span','div','br','sub','sup','strong','em'],
                        ALLOWED_ATTR: ['src','alt','style','class','rowspan','colspan','href','target','rel','dir','width','height'],
                        ALLOW_DATA_ATTR: false,
                        FORBID_ATTR: ['onerror','onclick']
                      });
                    }

                    function plainToHTMLStrict(src){
                      if (!src || typeof src !== 'string') return '';
                      const ESC = s => s.replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));
                      const lines = src.split(/\\r?\\n/);
                      const out = [];
                      for (let raw of lines){
                        let s = raw.trim();
                        if (!s) { out.push('<p>&nbsp;</p>'); continue; }
                        if (/^\\/\\/\\/+$/ .test(s)) { out.push('<hr>'); continue; }
                        s = ESC(s).replace(/(?:\\s*\\/\\/\\s*)+/g, '<br>');
                        const m = s.match(/^(\\*+|[\\-\\u2212\\u2013\\u2014]|[\\(\\[]?[0-9٠-٩]+[\\)\\.\\-:]|[IVXLC]+[\\)\\.\\:])\\s+(.*)$/i);
                        if (m){
                          const head = m[1], rest = m[2];
                          s = '<span class="lead-in">'+head+'</span> '+rest;
                        }
                        out.push('<p>'+s+'</p>');
                      }
                      if (!out.length) out.push('<p>&nbsp;</p>');
                      return out.join('');
                    }

                    function formatQuizContent(html){
                      if (!html || typeof html !== 'string') return '';
                      const looksHTML = /<\\/?[a-z][\\s\\S]*>/i.test(html);
                      const rendered = looksHTML ? html : plainToHTMLStrict(html);
                      const tempDiv = document.createElement('div');
                      tempDiv.innerHTML = rendered;
                      (function walk(node){
                        if (node.nodeType === Node.TEXT_NODE){
                          node.nodeValue = convertNumeralsInText(node.nodeValue);
                        } else if (node.nodeType === Node.ELEMENT_NODE){
                          for (let i=0;i<node.childNodes.length;i++) walk(node.childNodes[i]);
                        }
                      })(tempDiv);
                      return sanitizeHTML(tempDiv.innerHTML);
                    }

                    function shuffleOptionsOnce(qIndex){
                      if(studentState.shuffledMaps[qIndex]) return studentState.shuffledMaps[qIndex];
                      const q=studentState.questions[qIndex];
                      const map=(q.options||[]).map((_,i)=>i);
                      for(let i=map.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [map[i],map[j]]=[map[j],map[i]]; }
                      studentState.shuffledMaps[qIndex]=map; return map;
                    }

                    function startTimer(){
                      clearInterval(studentState.timerId);
                      const endAt=Date.now()+studentState.questionTime*1000;
                      studentState.timerId=setInterval(()=>{
                        if(studentState.isPaused) return;
                        const remain=Math.max(0, Math.ceil((endAt-Date.now())/1000));
                        studentState.timeLeft=remain; updateTimerDisplay();
                        if(remain<=0){ clearInterval(studentState.timerId); nextQuestion(); }
                      },200);
                    }
                    function updateTimerDisplay(){ const el=document.getElementById('timer'); if(el) el.textContent = 'Time left: '+formatNumber(studentState.timeLeft)+' seconds'; }
                    function updateQuestionCounter(){ const el=document.getElementById('questionCounter'); if(el) el.textContent = 'Question '+formatNumber(studentState.currentQuestion+1)+' of '+formatNumber(studentState.questions.length); }
                    function updateScoreCounter(){ const el=document.getElementById('scoreCounter'); if(el) el.textContent = 'Score: '+formatNumber(studentState.score)+' of '+formatNumber(studentState.questions.length); }

      function showQuestion(){
  clearInterval(studentState.timerId);
  studentState.timeLeft = studentState.questionTime;

  const readingTextElement = document.getElementById('readingText');
  const questionElement    = document.getElementById('question');
  const optionsElement     = document.getElementById('options');

  if (studentState.currentQuestion >= studentState.questions.length){
    showResult();
    return;
  }

  const q = studentState.questions[studentState.currentQuestion];

  // ----- القراءة -----
  if (readingTextElement){
    readingTextElement.innerHTML = '';
    let readingTextContent = '', readingImageSrc = null;
    if (q.reading){ readingTextContent = q.reading.text || ''; readingImageSrc = q.reading.image || null; }
    else if (q.readingText){
      readingTextContent = typeof q.readingText === 'string' ? q.readingText : (q.readingText.text || '');
      readingImageSrc    = typeof q.readingText === 'object'  ? (q.readingText.image || null) : null;
    } else if (q.paragraph){
      readingTextContent = q.paragraph; readingImageSrc = q.paragraphImage || null;
    }

    if (readingTextContent || readingImageSrc){
      readingTextElement.style.display = 'block';
      if (readingTextContent){
        const d = document.createElement('div');
        d.className = 'reading-text-content';
        d.innerHTML = formatQuizContent(readingTextContent);
        readingTextElement.appendChild(d);
      }
      if (readingImageSrc){
        const img = document.createElement('img');
        img.src = readingImageSrc;
        img.className = 'reading-text-image';
        img.alt = 'Reading image';
        img.loading = 'lazy';
        img.decoding = 'async';
        readingTextElement.appendChild(img);
      }
    } else {
      readingTextElement.style.display = 'none';
    }
  }

  // ----- السؤال -----
  if (questionElement){
    questionElement.innerHTML = '';
    const qc = document.createElement('div');
    qc.className = 'question-content';
    if (q.question?.text){
      const d = document.createElement('div');
      d.className = 'question-text';
      d.innerHTML = formatQuizContent(q.question.text);
      qc.appendChild(d);
    }
    if (q.question?.image){
      const i = document.createElement('img');
      i.src = q.question.image;
      i.className = 'question-image';
      i.alt = 'Question image';
      i.loading = 'lazy';
      i.decoding = 'async';
      qc.appendChild(i);
    }
    questionElement.appendChild(qc);
  }

  // ----- الخيارات -----
  if (!optionsElement) return;
  optionsElement.innerHTML = '';
  optionsElement.setAttribute('role','radiogroup');
  if (!q.options || q.options.length === 0){ console.warn('لا توجد خيارات لهذا السؤال'); return; }

  const map = shuffleOptionsOnce(studentState.currentQuestion);
  const valid = [];
  map.forEach((origIdx)=>{
    const opt = q.options[origIdx];
    if (!opt || (!opt.text && !opt.image)) return;

    const wrap = document.createElement('div');
    wrap.className = 'option';
    wrap.setAttribute('role', 'radio');
    wrap.setAttribute('tabindex', '0');
    wrap.setAttribute('aria-checked','false');

    const content = document.createElement('div');
    content.className = 'option-content';

    if (opt.image){
      const img = document.createElement('img');
      img.src = opt.image;
      img.className = 'option-image';
      img.alt = 'Option image';
      img.loading = 'lazy';
      img.decoding = 'async';
      content.appendChild(img);
    }
    if (opt.text){
      const span = document.createElement('span');
      span.className = 'option-text';
      span.innerHTML = formatQuizContent(opt.text);
      content.appendChild(span);
    }
    wrap.appendChild(content);

    if (studentState.answeredQuestions[studentState.currentQuestion] !== null){
      wrap.setAttribute('aria-disabled','true');
      if (origIdx === q.correct) wrap.classList.add('correct');
      if (studentState.answeredQuestions[studentState.currentQuestion] === false &&
          studentState.lastWrong[studentState.currentQuestion] === origIdx){
        wrap.classList.add('wrong');
      }
      const selectedIdx =
        studentState.answeredQuestions[studentState.currentQuestion] === true
          ? q.correct
          : studentState.lastWrong[studentState.currentQuestion];
      wrap.setAttribute('aria-checked', String(origIdx === selectedIdx));
    }

    wrap.onclick = ()=> checkAnswer(origIdx);
    wrap.onkeydown = (e)=>{
      if (e.key==='Enter' || e.key===' ') { e.preventDefault(); checkAnswer(origIdx); return; }
      if (e.key==='ArrowRight' || e.key==='ArrowDown' || e.key==='ArrowLeft' || e.key==='ArrowUp'){
        const items = Array.from(document.querySelectorAll('#options .option'));
        const idx = items.indexOf(wrap);
        let next = idx;
        if (e.key==='ArrowRight' || e.key==='ArrowDown') next++; else next--;
        if (next < 0) next = items.length - 1;
        if (next >= items.length) next = 0;
        const el = items[next]; if (el) el.focus();
      }
    };
    valid.push(wrap);
  });

  optionsElement.classList.remove('options-row','options-two','options-three');
  if (valid.length <= 3){
    optionsElement.classList.add('options-row');
    if (valid.length === 2) optionsElement.classList.add('options-two');
    else if (valid.length === 3) optionsElement.classList.add('options-three');
  }
  valid.forEach(v => optionsElement.appendChild(v));

  // أزرار/شريط التقدّم
  const prevBtn = document.getElementById('prevBtn'); if (prevBtn) prevBtn.disabled = (studentState.currentQuestion === 0);
  const nextBtn = document.getElementById('nextBtn'); if (nextBtn) nextBtn.disabled = false;

  const progressEl = document.getElementById('progress');
  if (progressEl){
    const total = Array.isArray(studentState.questions) ? studentState.questions.length : 0;
    const pct   = total > 0 ? (studentState.currentQuestion / total) * 100 : 0;
    progressEl.style.width = pct + '%';
  }

  updateQuestionCounter();
  updateScoreCounter();
  updateTimerDisplay();
  startTimer();
}

                    function checkAnswer(selectedIndex){
                      if(studentState.answeredQuestions[studentState.currentQuestion]!==null) return;
                      const q=studentState.questions[studentState.currentQuestion];
                      document.querySelectorAll('.option').forEach(o=>o.setAttribute('aria-disabled','true'));
                      const correct=q.correct;
                      if(selectedIndex===correct){ studentState.score++; studentState.answeredQuestions[studentState.currentQuestion]=true; }
                      else { studentState.answeredQuestions[studentState.currentQuestion]=false; studentState.lastWrong[studentState.currentQuestion]=selectedIndex; }
                      const map=studentState.shuffledMaps[studentState.currentQuestion]||[];
                      document.querySelectorAll('.option').forEach((el,i)=>{ const orig=map[i]; if(orig===correct) el.classList.add('correct'); if(studentState.answeredQuestions[studentState.currentQuestion]===false && orig===studentState.lastWrong[studentState.currentQuestion]) el.classList.add('wrong'); el.setAttribute('aria-checked', String(orig===selectedIndex)); });
                      updateScoreCounter();
                      if(studentState.currentQuestion < studentState.questions.length-1) setTimeout(nextQuestion, 1000); else setTimeout(showResult, 1000);
                    }

                    function nextQuestion(){ if(studentState.currentQuestion>=studentState.questions.length-1){ showResult(); return; } studentState.currentQuestion++; showQuestion(); }
                    function previousQuestion(){ if(studentState.currentQuestion>0){ studentState.currentQuestion--; showQuestion(); } }

                    function showResult(){
                      clearInterval(studentState.timerId);
                      const qb=document.querySelector('.quiz-box'); if (qb) qb.style.display='none';
                      const sb=document.getElementById('scoreBoard'); if (sb) sb.style.display='block';
                      const rt=document.getElementById('readingText'); if (rt) rt.style.display='none';
                      const ct=document.getElementById('countersBox'); if (ct) ct.style.display='none';
                      const fs=document.getElementById('finalScore'); if (fs) fs.textContent = formatNumber(studentState.score);
                      const tq=document.getElementById('totalQuestions'); if (tq) tq.textContent = formatNumber(studentState.questions.length);
                      applyNumeralTypeToPage();
                    }

                    function restartQuiz(){
                      studentState.currentQuestion=0; studentState.score=0; studentState.timeLeft=studentState.questionTime;
                      studentState.answeredQuestions=new Array(studentState.questions.length).fill(null);
                      studentState.lastWrong=new Array(studentState.questions.length).fill(null);
                      const qb=document.querySelector('.quiz-box'); if (qb) qb.style.display='block';
                      const sb=document.getElementById('scoreBoard'); if (sb) sb.style.display='none';
                      const ct=document.getElementById('countersBox'); if (ct) ct.style.display='flex';
                      const p=document.getElementById('progress'); if(p) p.style.width='0%';
                      document.querySelectorAll('.option').forEach(o=>{ o.classList.remove('correct','wrong'); o.removeAttribute('aria-disabled'); });
                      showQuestion(); applyNumeralTypeToPage();
                    }

                    function togglePause(){ studentState.isPaused=!studentState.isPaused; const b=document.getElementById('pauseBtn'); if (b){ b.textContent = studentState.isPaused ? 'Resume' : 'Pause'; b.style.background = studentState.isPaused ? '#28a745' : '#ffc107'; } }

                    window.addEventListener('load', ()=>{
                      const prevBtn=document.getElementById('prevBtn'); if(prevBtn) prevBtn.onclick = previousQuestion;
                      const nextBtn=document.getElementById('nextBtn'); if(nextBtn) nextBtn.onclick = nextQuestion;
                      const pauseBtn=document.getElementById('pauseBtn'); if(pauseBtn) pauseBtn.onclick = togglePause;
                      const restart=document.querySelector('.restart-btn'); if(restart) restart.onclick = restartQuiz;

                      // Keyboard shortcuts for quick selection: 1..9
                      document.addEventListener('keydown', (e)=>{
                        const tag = (e.target && e.target.tagName) || '';
                        if (tag==='INPUT' || tag==='TEXTAREA') return;
                        if (!/^\d$/.test(e.key)) return;
                        const idx = Number(e.key) - 1;
                        const map = studentState.shuffledMaps[studentState.currentQuestion] || [];
                        if (idx>=0 && idx<map.length && studentState.answeredQuestions[studentState.currentQuestion]===null){
                          e.preventDefault();
                          const origIdx = map[idx];
                          if (origIdx !== undefined) checkAnswer(origIdx);
                        }
                      });

                      studentState.answeredQuestions=new Array(studentState.questions.length).fill(null);
                      studentState.lastWrong=new Array(studentState.questions.length).fill(null);
                      showQuestion(); applyNumeralTypeToPage();
                    });
                  })();
                `;
          head.appendChild(studentScript);

          teacherHTML.querySelectorAll("script").forEach((s) => {
            const src = s.getAttribute("src") || "";
            const keep =
              s.hasAttribute("data-keep") || s.hasAttribute("data-inline-lib");
            const isPur = /dompurify|purify/i.test(src);
            if (
              !keep &&
              !isPur &&
              (typeof studentScript === "undefined" || s !== studentScript)
            )
              s.remove();
          });

          const out = "<!DOCTYPE html>\n" + teacherHTML.outerHTML;
          const blob = new Blob([out], { type: "text/html" });
          const url = URL.createObjectURL(blob);
          const suffix = numeral;
          const a = document.createElement("a");
          a.href = url;
          a.download = "quiz_student_lite_" + suffix + ".html";
          a.click();
          setTimeout(() => URL.revokeObjectURL(url), 200);
        } catch (err) {
          console.error("Error while saving the student (Lite) version:", err);
          alert("An error occurred while saving the student (Lite) version.");
        }
      }

      function resetProgress() {
        if (!confirm("Reset progress?")) return;
        localStorage.removeItem(STORAGE_KEY);
        state.currentQuestion = 0;
        state.score = 0;
        state.timeLeft = state.questionTime;
        state.answeredQuestions = new Array(state.questions.length).fill(null);
        state.lastWrong = new Array(state.questions.length).fill(null);
        state.shuffledMaps = [];
        showQuestion();
      }

      window.addEventListener("load", () => {
        const rt = document.getElementById("readingText");
        if (rt) rt.style.display = "none";
        document.getElementById("loadButton").onclick = loadQuestionsFromFile;
        document.getElementById("saveQuestionsButton").onclick =
          saveQuestionsToFile;
        document.getElementById("saveAppButton").onclick = saveAppForOfflineUse;
        // Keyboard shortcuts for quick selection: 1..9
        document.addEventListener("keydown", (e) => {
          const tag = (e.target && e.target.tagName) || "";
          if (tag === "INPUT" || tag === "TEXTAREA") return;
          if (!/^\d$/.test(e.key)) return;
          const idx = Number(e.key) - 1;
          const map = state.shuffledMaps[state.currentQuestion] || [];
          if (
            idx >= 0 &&
            idx < map.length &&
            state.answeredQuestions[state.currentQuestion] === null
          ) {
            e.preventDefault();
            const origIdx = map[idx];
            if (origIdx !== undefined) checkAnswer(origIdx);
          }
        });
        document.getElementById("questionCounter").textContent =
          "Question " + formatNumber(0) + " of " + formatNumber(0);
        document.getElementById("timer").textContent =
          "Time left: " + formatNumber(state.timeLeft) + " seconds";
        document.getElementById("scoreCounter").textContent =
          "Score: " + formatNumber(0) + " of " + formatNumber(0);
        init();
      });

      document.addEventListener("paste", (e) => {
        const item = [...(e.clipboardData?.items || [])].find(
          (i) => i.type && i.type.startsWith("image/")
        );
        if (!item) return;
        const file = item.getAsFile();
        const r = new FileReader();
        r.onload = () => {
          const url = r.result;
          const q = state.questions[state.currentQuestion] || {};
          if (!q.question) q.question = { text: "", image: null };
          q.question.image = url;
          showQuestion();
          persist();
        };
        r.readAsDataURL(file);
      });
    </script>
  </body>
</html>
